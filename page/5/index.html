<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/iBlogWebsite/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/iBlogWebsite/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/iBlogWebsite/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/iBlogWebsite/images/logo.svg" color="#222">

<link rel="stylesheet" href="/iBlogWebsite/css/main.css">


<link rel="stylesheet" href="/iBlogWebsite/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"leeeyou.github.io","root":"/iBlogWebsite/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Leeeyou123">
<meta property="og:url" content="https://leeeyou.github.io/iBlogWebsite/page/5/index.html">
<meta property="og:site_name" content="Leeeyou123">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Leeeyou">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://leeeyou.github.io/iBlogWebsite/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Leeeyou123</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/iBlogWebsite/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Leeeyou123</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/iBlogWebsite/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/iBlogWebsite/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/iBlogWebsite/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/iBlogWebsite/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leeeyou.github.io/iBlogWebsite/2018/04/11/2018/2018-04-11-%E7%AE%97%E6%B3%95%E4%B9%8B%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/6735624?s=460&v=4">
      <meta itemprop="name" content="Leeeyou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leeeyou123">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iBlogWebsite/2018/04/11/2018/2018-04-11-%E7%AE%97%E6%B3%95%E4%B9%8B%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">算法之复杂度分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-04-11 00:00:00" itemprop="dateCreated datePublished" datetime="2018-04-11T00:00:00+08:00">2018-04-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-29 20:35:27" itemprop="dateModified" datetime="2022-11-29T20:35:27+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/iBlogWebsite/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>对于算法的复杂度，一直是懵懂状态。索性这次将这段时间听到看到的一些内容整理出来，以求准确清晰的理解它。</p>
<p>听吴军老师的音频，才了解在计算机发展初期，对于算法好坏的评判标准科学家也是不清楚的，1965年哈特马尼斯（Juris Hartmanis）和斯坦恩斯（Richard Stearns）提出了算法复杂度的概念（二人后来因此获得了图灵奖），计算机科学家们开始考虑一个公平的、一致的评判算法好坏的方法。不过，最早将复杂度严格量化衡量的是著名计算机科学家、算法分析之父 <strong>高德纳（Don Knuth）</strong> 。今天全世界计算机领域都以高德纳的思想为准。</p>
<p>高德纳的思想主要包括这三个部分：</p>
<ol>
<li><p>在比较算法的快慢时，需要考虑数据量特别特别大，大到近乎无穷大时的情况。为什么要比大数的情况，而不比小数的情况呢？因为计算机的发明就是为了处理大量数据的，而且数据越处理越多。</p>
</li>
<li><p>决定算法快慢的因素虽然可能很多，但是所有的因素都可以被分为两类。第一类是不随数据量变化的因素，第二类是随着数量变化的。</p>
<ul>
<li><p>比如说，有一种大小排序的算法，它的运算次数是10倍的N平方，其中N是要排序的数字的数量。前面的那个10倍是个常数，和N的大小显然没有关系，10个数排序是如此，一亿个数排序时也是如此。而后面的N平方自然和N有关系了。高德纳讲，我们在研究算法时，不必考虑前面那个不变的常数，它是10倍，还是1倍，或者是100倍，只需要看后面那个变化的因素即可。</p>
</li>
<li><p>因为N这个数趋近于无穷大时，前面那个不变的常数的影响是微乎其微的，算法的速度主要由后面一个因素决定。比如，当N＝10的时候，N平方就是100；N＝100，N平方就是1万；N＝1万，N平方就是一亿……总之，N平方这个因子的变化非常快。更广泛地讲，任何随着N变化的因素，通常会造成量级的差异。量级就如同芝麻和西瓜的差异，西瓜和地球的差异。100个芝麻是无法和一个西瓜去对比的。</p>
</li>
</ul>
</li>
<li><p>如果两种算法 <strong>在量级上相当</strong> ，在计算机科学里，就认为它们是一样好的，也就是计算机科学家并不关心三五倍的差别，这就好比1粒芝麻和5粒芝麻都是芝麻量级的东西，大家就不要比了。只有当科学家们不关心几倍的差异后，才可能集中精力考虑量级的差异。也就是说，计算机科学家要尽可能地去捡西瓜。事实上在计算机科学领域，如果谁说自己把目前最好的算法速度提升了一倍，这种论文是无法发表的。</p>
</li>
</ol>
<p>在了解了高德纳提出的思想后，对于算法复杂度关心的点以及评判标准才有了“最正宗”的理解。关心的是大量数据的问题，排除掉不变的因素，且只关注量级的差别，这其实是一个理想的环境，这种假设是非常有意义的。吴军老师说“回顾下科学发展的历史，那些能总结出理论的人要做的第一件事，就是多虑掉所有次要的因素，构建一个理想的环境（或者虚拟的环境），其目的是找到真正的主要矛盾，先把主要问题解决了再说。这些人的思维方式，比普通人是高出一大截的。我们都同意艺术上要有想象力，其实在科学上也是如此，抽象的想象力很重要。”</p>
<p>在有了上面这段内容作为基础后，下面对时间复杂度和空间复杂度的讲述会简单很多。</p>
<h1 id="1-时间复杂度"><a href="#1-时间复杂度" class="headerlink" title="1. 时间复杂度"></a>1. 时间复杂度</h1><p>一句话描述就是：<strong>一个算法在问题规模不断增大时对应的时间增长曲线。</strong><br>看完下面这两张图，你大概能理解问题规模的增大以及时间增长曲线之间的关系。</p>
<p><img src="https://github.com/Leeeyou/iBlogWebsite/blob/master/images/2018/code/algorithm-time-complexity-summary.jpg?raw=true" alt="algorithm-time-complexity-summary"></p>
<p><img src="https://github.com/Leeeyou/iBlogWebsite/blob/master/images/2018/code/algorithm-time-complexity-problem-size.jpg?raw=true" alt="algorithm-time-complexity-problem-size"></p>
<p>从第二张图可以直观的反应出指数、立方和平方级别同线性对数级别的时间增长曲线不在一个量级上。所以你在写代码时，到底选择怎样的时间曲线增长量级是不是有底了？这里其实也印证了高德纳思想的第1和第3点，那第2点排除掉不变的因素怎么理解，这需要用到数学公式了。</p>
<p>在数学上定义： 存在常数 c，使得当 N &gt;= c 时 T(N) &lt;= f(N)，表示为 T(n) = O(f(n)) 。<br>算法需要执行的运算次数 用输入大小n的函数表示，即 T(n)。如下图示：  </p>
<p><img src="https://github.com/Leeeyou/iBlogWebsite/blob/master/images/2018/code/algorithm-time-complexity-math.jpg?raw=true" alt="algorithm-time-complexity-math"></p>
<p>当 N &gt;= 2 的时候，f(n) = n^2 总是大于 T(n) = n + 2 的，于是我们说 f(n) 的增长速度是大于或者等于 T(n) 的，也说 f(n) 是 T(n) 的上界，可以表示为 T(n) = O(f(n))。</p>
<p>因为f(n) 的增长速度是大于或者等于 T(n) 的，即T(n) = O(f(n))，所以我们可以用 f(n) 的增长速度来度量 T(n) 的增长速度，所以我们说这个算法的时间复杂度是 O(f(n))。其实就是我们通常所说的大O推倒法，几条重要的准则如下：<br>1.用常数1来取代运行时间中所有加法常数。<br>2.修改后的运行次数函数中，只保留最高阶项。<br>3.如果最高阶项存在且不是1，则去除与这个项相乘的常数。  </p>
<p>至此，时间复杂度讲述完毕，没有复杂的描述，利用几张图和一个数学公式推倒就能理解好。另外还需要掌握时间复杂度分析的基本策略：<strong>从内向外分析，从最深层开始分析。如果遇到函数调用，要深入函数进行分析。</strong></p>
<h1 id="2-空间复杂度"><a href="#2-空间复杂度" class="headerlink" title="2. 空间复杂度"></a>2. 空间复杂度</h1><p>空间复杂度讨论的是<strong>算法所需要的辅助存储空间</strong>，其中输入数据所占用的具体空间取决于问题本身, 与算法无关。记作：<br>S(n) = O(f(n))</p>
<p>若算法执行时间时所需要的辅助空间相对于输入数据量而言是一个常数，则称这个算法为原地工作， 辅助空间为O(1)。</p>
<p>将一维数组a中的n个数据逆序存放到原数组中, 下面是两种算法:</p>
<p>[算法1]<br>S(n) = O(n)  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++)    b[i] = a[n - i - <span class="number">1</span>];   <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++)    a[i] = b[i]  </span><br></pre></td></tr></table></figure>

<p>[算法2]<br>S(n) = O(1)  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i &lt; n/<span class="number">2</span>; i++)&#123;    t = a[i];    a[i] = a[n - i - <span class="number">1</span>];    a[n - i - <span class="number">1</span>] = t;   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>算法1的空间复杂度为O(n), 需要一个大小为n的辅助数组b</li>
<li>算法2的空间复杂度为O(1), 仅需要一个变量t, 与问题规模n无关</li>
</ul>
<p>算法的空间复杂度与时间复杂度合称为算法的复杂度。面对不同的算法如何选择主要就从这两个方面去考虑，理想情况是一个算法的时间与空间复杂度都小，但这是很难做到的，面对不同的情况要具体问题具体分析: 是以时间换空间, 还是以空间换时间。</p>
<p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f4cca5ce055a">(数据结构）十分钟从零搞定时间复杂度（计算算法的时间复杂度)</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/21387264">如何理解算法时间复杂度的表示法O(n²)、O(n)、O(1)、O(nlogn)等？</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/itachi85/article/details/54882603"> 算法（一）时间复杂度</a>  </li>
<li><a target="_blank" rel="noopener" href="https://ghui.me/post/2016/08/algorithm_performance/">算法的性能分析</a>  </li>
<li><a href="https://leeeyou.github.io/2016/02/01/blog-2016-02-01-%E7%AE%97%E6%B3%95%E4%B9%8B%E5%9F%BA%E6%9C%AC%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">算法之基本排序算法</a>  </li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leeeyou.github.io/iBlogWebsite/2018/02/27/2018/2018-02-27-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8BAndroid%E7%BE%A4%E8%8B%B1%E4%BC%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/6735624?s=460&v=4">
      <meta itemprop="name" content="Leeeyou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leeeyou123">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iBlogWebsite/2018/02/27/2018/2018-02-27-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8BAndroid%E7%BE%A4%E8%8B%B1%E4%BC%A0/" class="post-title-link" itemprop="url">读书笔记之Android群英传</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-02-27 00:00:00" itemprop="dateCreated datePublished" datetime="2018-02-27T00:00:00+08:00">2018-02-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-29 20:35:27" itemprop="dateModified" datetime="2022-11-29T20:35:27+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/iBlogWebsite/categories/opinion/" itemprop="url" rel="index"><span itemprop="name">opinion</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="../../../../images/readingNotes/Android%E7%BE%A4%E8%8B%B1%E4%BC%A0/Android%E7%BE%A4%E8%8B%B1%E4%BC%A0.jpg" alt="Android群英传"></p>
<p>1、怎样区别Dalvik与ART的异同？<br>2、怎样理解Android UI界面架构图？<br>3、怎样理解requestWindowFeature的设置时机？<br>4、怎样理解当创建一个Canvas对象时，要传入一个bitmap对象？<br>5、怎样做好UI模板？<br>6、怎样理解getScrollX()和getScrollY()?<br>7、怎样自定义一个简单的scrollView和viewPager，理清思路？<br>8、怎样理解事件拦截中的时间传递和事件处理？<br>9、怎样设置ListView为空时的样式？<br>10、怎样判断ListView是否滚到最后一行？<br>11、怎样判断ListView的滚动方向？<br>12、怎样获取ActionBar的高度？<br>13、怎样理解Android坐标系中的各种方法？<br>14、怎样使用MarginLayoutParams?<br>15、怎样理解scrollTo和scrollBy参数正负值的含义？<br>16、怎样理解canvas的4个方法？<br>17、怎样理解颜色矩阵？<br>18、怎样理解图形变换矩阵？<br>19、怎样实现自定义刮刮乐效果？<br>20、怎样理解SurfaceView和View的异同和使用场景？<br>21、怎样绘制正弦曲线？<br>22、怎么理解Android任务栈？<br>23、怎样实现在真机上检测布局层级？  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leeeyou.github.io/iBlogWebsite/2018/02/26/2018/2018-02-06-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%BE%E8%A7%A3HTTP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/6735624?s=460&v=4">
      <meta itemprop="name" content="Leeeyou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leeeyou123">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iBlogWebsite/2018/02/26/2018/2018-02-06-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%BE%E8%A7%A3HTTP/" class="post-title-link" itemprop="url">读书笔记之图解HTTP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-02-26 00:00:00" itemprop="dateCreated datePublished" datetime="2018-02-26T00:00:00+08:00">2018-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-29 20:35:27" itemprop="dateModified" datetime="2022-11-29T20:35:27+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/iBlogWebsite/categories/opinion/" itemprop="url" rel="index"><span itemprop="name">opinion</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="../../../../images/readingNotes/%E5%9B%BE%E8%A7%A3HTTP/%E5%9B%BE%E8%A7%A3HTTP.jpg" alt="图解HTTP"></p>
<p>大概去年5月份的时候，从同事桌上看到这本书，随手一翻觉得里面的插图很有意思，留下了深刻的印象。这几天花了几个小时的时间看完之后，收获颇多。总得来说，这是一本偏基础的书，阅读起来没什么困难，对我而言，主要是理顺了一些之前模棱两可的概念。<br>TCP/IP协议族按层次分别是：应用层、传输层、网络层和数据链路层。层次化之后，设计也变得相对简单了。处于应用层上的应用可以只考虑分派给自己的任务，而不需要弄清对方在地球上哪个地方、对方的传输路线是怎样的、是否能确保传输送达等问题。简单来说就是职责单一化了，可以只关心自己应该关心的内容。</p>
<p>应用层：应用层决定了向用户提供应用服务时通信的活动。<br>TCP/IP协议族内预存了各类通用的应用服务。比如，FTP（File Transfer Protocol，文件传输协议）和DNS（Domain Name System，域名系统）服务就是其中两类。HTTP协议也处于该层。</p>
<p>传输层：传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。在传输层有两个性质不同的协议：TCP（Transmission Control Protocol，传输控制协议）和UDP（User Data Protocol，用户数据报协议）。</p>
<p>网络层：网络层用来处理在网络上流动的数据包。数据包是网络传输的最小数据单位。该层规定了通过怎样的路径（所谓的传输路线）到达对方计算机，并把数据包传送给对方。与对方计算机之间通过多台计算机或网络设备进行传输时，网络层所起的作用就是在众多的选项内选择一条传输路线。</p>
<p>链路层：用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动、NIC（Network Interface Card，网络适配器，即网卡），及光纤等物理可见部分（还包括连接器等一切传输媒介）。硬件上的范畴均在链路层的作用范围之内。</p>
<p>经过作者的讲述后，对四层的职责，分别干了些什么是不是有了很明确的了解。反正经过这段文字之后，我是有种顿悟的感觉。</p>
<p>当输入一个网址后接着发生了什么？这段描述或许会给你一个清晰的认知流程：“利用TCP/IP协议族进行网络通信时，会通过分层顺序与对方进行通信。发送端从应用层往下走，接收端则往应用层往上走。我们用HTTP举例来说明，首先作为发送端的客户端在应用层（HTTP协议）发出一个想看某个Web页面的HTTP请求。接着，为了传输方便，在传输层（TCP协议）把从应用层处收到的数据（HTTP请求报文）进行分割，并在各个报文上打上标记序号及端口号后转发给网络层。在网络层（IP协议），增加作为通信目的地的MAC地址后转发给链路层。这样一来，发往网络的通信请求就准备齐全了。接收端的服务器在链路层接收到数据，按序往上层发送，一直到应用层。当传输到应用层，才能算真正接收到由客户端发送过来的HTTP请求。发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该层所属的首部信息。反之，接收端在层与层传输数据时，每经过一层时会把对应的首部消去。 ”下面图示更能清晰明了说明问题：</p>
<p><img src="../../../../images/readingNotes/%E5%9B%BE%E8%A7%A3HTTP/%E5%9B%BE%E8%A7%A3HTTP1.jpg" alt="getScrollX"></p>
<p>在HTTP协议中，状态码的职责是当客户端向服务器端发送请求时，描述返回的请求结果。借助状态码，用户可以知道服务器端是正常处理了请求，还是出现了错误。数字中的第一位指定了响应类别，详细如下图所示：</p>
<p><img src="../../../../images/readingNotes/%E5%9B%BE%E8%A7%A3HTTP/%E5%9B%BE%E8%A7%A3HTTP2.jpg" alt="getScrollX"></p>
<p>HTTP首部字段大致分为四类：通用首部字段，请求首部字段，响应首部字段，实体首部字段。<br><img src="../../../../images/readingNotes/%E5%9B%BE%E8%A7%A3HTTP/%E5%9B%BE%E8%A7%A3HTTP3.jpg" alt="getScrollX"><br><img src="../../../../images/readingNotes/%E5%9B%BE%E8%A7%A3HTTP/%E5%9B%BE%E8%A7%A3HTTP4.jpg" alt="getScrollX"><br><img src="../../../../images/readingNotes/%E5%9B%BE%E8%A7%A3HTTP/%E5%9B%BE%E8%A7%A3HTTP5.jpg" alt="getScrollX"><br><img src="../../../../images/readingNotes/%E5%9B%BE%E8%A7%A3HTTP/%E5%9B%BE%E8%A7%A3HTTP6.jpg" alt="getScrollX">  </p>
<p>在这些首部字段中，有很多值得关注。</p>
<p>例如no-cache字段，使用no-cache指令的目的是为了防止从缓存中返回过期的资源。客户端发送的请求中如果包含no-cache指令，则表示客户端将不会接收缓存过的响应。于是，“中间”的缓存服务器必须把客户端请求转发给源服务器。如果服务器返回的响应中包含no-cache指令，那么缓存服务器不能对资源进行缓存。源服务器以后也将不再对缓存服务器请求中提出的资源有效性进行确认，且禁止其对响应资源进行缓存操作。</p>
<p>例如首部字段If-Modified-Since，属附带条件之一，它会告知服务器若If-Modified-Since字段值早于资源的更新时间，则希望能处理该请求。而在指定If-Modified-Since字段值的日期时间之后，如果请求的资源都没有过更新，则返回状态码304 Not Modified的响应。If-Modified-Since用于确认代理或客户端拥有的本地资源的有效性。获取资源的更新日期时间，可通过确认首部字段Last-Modified来确定。</p>
<p>例如首部字段Expire，s会将资源失效的日期告知客户端。缓存服务器在接收到含有首部字段Expires的响应后，会以缓存来应答请求，在Expires字段值指定的时间之前，响应的副本会一直被保存。当超过指定的时间后，缓存服务器在请求发送过来时，会转向源服务器请求资源。源服务器不希望缓存服务器对资源缓存时，最好在Expires字段内写入与首部字段Date相同的时间值。但是，当首部字段Cache-Control有指定max-age指令时，比起首部字段Expires，会优先处理max-age指令。</p>
<p>书籍的结尾章节主要讨论的是HTTP的缺点、性能、安全问题，这里不再总结。关于网络的知识总结，可以参考我写的一篇日志：<a href="https://leeeyou.github.io/2016/12/28/blog-2016-12-28-Android%E4%B9%8B%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E6%95%B4%E7%90%86/">Android之网络通信整理</a></p>
<p>总得来说，这本书的内容简单、阅读起来无障碍，主要用于疏通知识点，值得一阅。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leeeyou.github.io/iBlogWebsite/2017/07/04/2017/2017-07-04-Android%E9%A1%B9%E7%9B%AE%E6%95%B4%E5%90%88RN%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/6735624?s=460&v=4">
      <meta itemprop="name" content="Leeeyou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leeeyou123">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iBlogWebsite/2017/07/04/2017/2017-07-04-Android%E9%A1%B9%E7%9B%AE%E6%95%B4%E5%90%88RN%E8%AF%B4%E6%98%8E%E6%96%87%E6%A1%A3/" class="post-title-link" itemprop="url">Android项目整合RN说明文档</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-04 00:00:00" itemprop="dateCreated datePublished" datetime="2017-07-04T00:00:00+08:00">2017-07-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-29 20:35:27" itemprop="dateModified" datetime="2022-11-29T20:35:27+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/iBlogWebsite/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="step1-native项目准备工作"><a href="#step1-native项目准备工作" class="headerlink" title="step1: native项目准备工作"></a>step1: native项目准备工作</h1><p>在app module下的build.gradle文件的dependencies中添加React Native 依赖：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">&quot;com.facebook.react:react-native:+&quot;</span></span><br></pre></td></tr></table></figure>

<p>com.android.support:appcompat的版本号用23.0.1，同时修改compileSdkVersion和buildToolsVersion</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">compileSdkVersion <span class="number">23</span></span><br><span class="line">buildToolsVersion <span class="string">&quot;23.0.1&quot;</span></span><br><span class="line">defaultConfig &#123;</span><br><span class="line">    applicationId <span class="string">&quot;com.quncao.testsize&quot;</span></span><br><span class="line">    minSdkVersion <span class="number">16</span></span><br><span class="line">    targetSdkVersion <span class="number">22</span></span><br><span class="line">    versionCode <span class="number">1</span></span><br><span class="line">    versionName <span class="string">&quot;1.0&quot;</span></span><br><span class="line">    ndk&#123;</span><br><span class="line">        abiFilters <span class="string">&quot;armeabi-v7a&quot;</span>, <span class="string">&quot;x86&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改清单文件，增加如下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity android:name=<span class="string">&quot;com.facebook.react.devsupport.DevSettingsActivity&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h1 id="step2-将android工程改造成react-native工程"><a href="#step2-将android工程改造成react-native工程" class="headerlink" title="step2: 将android工程改造成react-native工程"></a>step2: 将android工程改造成react-native工程</h1><p>引入或者创建package.json文件  </p>
<ul>
<li>可以通过命令<code>npm init</code>创建，也可以复制一个空RN工程中的package.json</li>
</ul>
<p>引入或者创建node_modules文件  </p>
<ul>
<li>可以通过命令<code>npm install --save react react-native</code>创建，也可以复制一个空RN工程中的node_modules文件夹</li>
</ul>
<p>引入或者创建.flowconfig文件   </p>
<ul>
<li>可以通过<code>curl -o .flowconfig https://raw.githubusercontent.com/facebook/react-native/master/.flowconfig</code>创建，也可以复制一个空RN工程中的.flowconfig文件</li>
</ul>
<p>引入或者创建index.android.js文件</p>
<p>在项目根目录的build.gradle中(注意：不是app模块中的build.gradle文件)添加依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        jcenter()</span><br><span class="line">        maven &#123;</span><br><span class="line">            <span class="comment">// All of React Native (JS, Obj-C sources, Android binaries) is installed from npm</span></span><br><span class="line">            url <span class="string">&quot;$projectDir/../node_modules/react-native/android&quot;</span></span><br><span class="line"><span class="comment">//            url &quot;$rootDir/../node_modules/react-native/android&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里需要注意url的值，上面是指向了当前工程中的node_modules文件夹，而<code>$rootDir/../node_modules/react-native/android</code>这句会引用默认的react-native的版本，通常会是0.21.0</p>
<h1 id="step3-改造Applicatioin"><a href="#step3-改造Applicatioin" class="headerlink" title="step3: 改造Applicatioin"></a>step3: 改造Applicatioin</h1><p>实现ReactApplication类，并修改清单文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> <span class="keyword">extends</span> <span class="title class_">Application</span> <span class="keyword">implements</span> <span class="title class_">ReactApplication</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReactNativeHost</span> <span class="variable">mReactNativeHost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReactNativeHost</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">getUseDeveloperSupport</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> BuildConfig.DEBUG;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> List&lt;ReactPackage&gt; <span class="title function_">getPackages</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Arrays.&lt;ReactPackage&gt;asList(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">MainReactPackage</span>()</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ReactNativeHost <span class="title function_">getReactNativeHost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mReactNativeHost;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="step4-编写Activity，返回RN页面"><a href="#step4-编写Activity，返回RN页面" class="headerlink" title="step4: 编写Activity，返回RN页面"></a>step4: 编写Activity，返回RN页面</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.quncao.testsize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.facebook.react.ReactActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SettingActivity</span> <span class="keyword">extends</span> <span class="title class_">ReactActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getMainComponentName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;TestSize&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里需要注意getMainComponentName的值和index.android.js这个文件中的registerComponent值保持一致</p>
<p>Demo工程：链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1eSL4P7k">https://pan.baidu.com/s/1eSL4P7k</a> 密码: ggav</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leeeyou.github.io/iBlogWebsite/2017/05/11/2017/2017-05-11-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%B8%80%E4%B8%87%E5%B0%8F%E6%97%B6%E5%A4%A9%E6%89%8D%E7%90%86%E8%AE%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/6735624?s=460&v=4">
      <meta itemprop="name" content="Leeeyou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leeeyou123">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iBlogWebsite/2017/05/11/2017/2017-05-11-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%B8%80%E4%B8%87%E5%B0%8F%E6%97%B6%E5%A4%A9%E6%89%8D%E7%90%86%E8%AE%BA/" class="post-title-link" itemprop="url">读书笔记之一万小时天才理论</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-05-11 00:00:00" itemprop="dateCreated datePublished" datetime="2017-05-11T00:00:00+08:00">2017-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-29 20:35:27" itemprop="dateModified" datetime="2022-11-29T20:35:27+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/iBlogWebsite/categories/opinion/" itemprop="url" rel="index"><span itemprop="name">opinion</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="../../../../images/readingNotes/%E4%B8%80%E4%B8%87%E5%B0%8F%E6%97%B6%E5%A4%A9%E6%89%8D%E7%90%86%E8%AE%BA/%E4%B8%80%E4%B8%87%E5%B0%8F%E6%97%B6%E5%A4%A9%E6%89%8D%E7%90%86%E8%AE%BA.jpg" alt="一万小时天才理论"></p>
<p>断断续续看完了这本书，印象最深的一个词是髓鞘质，然后就是感觉这本书有点啰嗦，大量的采访素材堆砌。总得来说用一句话就能概括本书：【激情+伯乐+精深练习一万小时 = 天才】。当然还是有些细节部分是很出彩的，至少在我没接触这本书之前，对于精深练习这个词是没有任何概念的。</p>
<p>本书传递的一个价值观可能是：我们口中的“天才”其实就处在我们的周围，或者是你的邻居，或者是你镇上的某个同学，在经过上面公式的“摧残”后成名。请务必不要说什么一夜成名，哪有什么一夜成名的事情发生，鬼知道别人经历的什么。</p>
<p>关于精深练习的部分，作者用的笔墨是最多的，就是想要告诉读者：朝着既定目标挣扎前进，挑战自己的能力极限，不断犯错，汲取经验，不断犯错，汲取经验，然后你以为自己快要成功的时候，成功却与你失之交臂，此时应该给自己一些掌声，生活哪有随随便便的成功，当然会一波好几折。其实此时有个东西在潜移默化的进化着，是的，它是髓鞘质，通过你不断重复的练习和刺激，形成了一个绝缘的神经回路。当你的髓鞘质生长到足够强大，其实就是练习的次数足够多的时候，在你的领域距离“专家”就越近。</p>
<p>为什么目标明确、重视错误的练习如此有效呢？因为构建一条好的神经回路，最佳的方法就是开启电流，处理错误，然后重启，就这样一遍遍重复这个过程。努力拼搏不是无关紧要的过程，而是生理上的必经之路。所以人才和技能的故事就是髓鞘质的故事，看到这里你是不是有点失望呢？</p>
<p>精深练习需要时间，时刻保持激情就显示尤为重要。当然在你精深练习的时候，没个好的教练怎么能行呢，所以赶紧去找个伯乐吧，他会在自身拥有了强大知识库和深厚的认识后，灵活的根据你的自身情况调整施教策略。所以想成为天才的你准备好了吗？</p>
<p>下面是摘录内容：</p>
<h2 id="第一部分-精深"><a href="#第一部分-精深" class="headerlink" title="第一部分 精深"></a>第一部分 精深</h2><ul>
<li><p>谁也不能随随便便成功，它来自彻底的自我管理和毅力。——哈佛图书馆训言</p>
</li>
<li><p>精深练习是建立在一个悖论之上的：朝着既定目标挣扎前进，挑战自己的能力极限，不断犯错，会让你更聪明。类似的说法是，做那些不得不放慢节奏的事情，犯错并加以改正——就像爬冰山，刚开始的时候会滑倒，会跌跌撞撞，最后不知不觉中就变得敏捷自如。</p>
</li>
<li><p>林克的训练器可以让飞行员的练习更加深入：停下，犹豫，犯错，并从中吸取经验。在林克训练器里坐上几小时，飞行员可以在操作面板上“起飞”、“降落”十几次。可以俯冲、失速，再调节恢复正常，可以在那个挑战自己能力极限的最佳位置上停留数小时，而在真正的飞机上是不可能冒这个险的。</p>
</li>
<li><p>那些用林克训练器训练出来的航空队飞行员并非比那些失事的飞行员更勇敢、更聪明，而只是多了一个精深练习的机会。</p>
</li>
<li><p>我一直认为，除了傻子，人在智力上差别不大，不同的只是热情和努力。——查尔斯·达尔文</p>
</li>
<li><p>目标明确的练习能够将学习速度提高10倍，这听起来就像那个神话故事，一小把种子长成了一根有魔力的长藤，长藤通往成才的天堂。</p>
</li>
<li><p>神经元完成的每一个动作都非常迅速，就在开关的一开一合之间。”菲尔茨谈及突触时说，“但是一开一关不是我们学习大多数事物的方法。弹好钢琴，下好象棋，打好棒球都非一日之功，但都是髓鞘质所擅长的。</p>
</li>
<li><p>人才和技能的故事就是髓鞘质的故事。</p>
</li>
<li><p> 问：为什么目标明确、重视错误的练习如此有效呢？答：因为构建一条好的神经回路，最佳的方法就是开启电流，处理错误，然后重启，就这样一遍遍重复这个过程。努力拼搏不是无关紧要的过程，而是生理上的必经之路。</p>
</li>
<li><p>犯错绝不是可有可无的——从神经学的角度来说，这是必须的：要想使技能回路达到最佳状态，必须先找到次佳位置；你必须犯错误，并关注这些错误；你得慢慢地锻炼自己的回路。你还必须持续开启那个回路（练习）以保持髓鞘质运作正常。毕竟，髓鞘质是活体组织。</p>
</li>
<li><p>任何领域的任何专家都要经过10000小时专心致志地练习。</p>
</li>
<li><p>它意味着所有的技能都可以通过同一套基本生理机制获得，并且进一步指出该生理机制有其生理极限，无人能幸免。</p>
</li>
<li><p>精深练习×一万小时=世界级技能</p>
</li>
<li><p>哇塞效应（Holy Shit Effect，缩写HSE），意思是当人才突然从天而降时，人们产生的一种强烈而复杂的情感：怀疑、崇拜以及妒忌（顺序不分先后）。</p>
</li>
<li><p>哇塞效应是那种人们在看到跟自己一样的普通人拥有盖世才华时产生的感受。</p>
</li>
<li><p>看见邻街那个傻孩子突然成了著名摇滚乐队的主吉他手，或是看见自家孩子对微分学熟练到令人费解时，心底产生的那种讶异，同时还有点隐隐作痛。</p>
</li>
<li><p>秘技第一式：组块化</p>
</li>
<li><p>精深练习就是构建神经回路，并使之裹上绝缘体。</p>
</li>
<li><p>为什么放慢节奏如此有效呢？首先，放慢练习节奏使你更加关注错误，每一次都提高了精确度——而对于髓鞘质的生长而言，精确就是一切。</p>
</li>
<li><p>第二，放慢练习给了练习者更重要的东西：技能的形状和节奏。</p>
</li>
<li><p>重复练习是无可替代且千金难求的，然而，要补充解释几点。常规练习是练得越多越好，但是，精深练习并不适用这道等式。投入更多的时间练习是有用的，但前提是你必须处于最佳位置。更重要的是，一个人每天能进行多久的精深练习似乎是有普遍限制的。</p>
</li>
<li><p>练习就是每天弹奏同样的音符，人类基本的姿态——为一个想法努力，为你渴望的伟大成就努力争取，然后感觉它与你失之交臂。</p>
</li>
<li><p>正是这种感觉，精深练习不是简单的挣扎，而是有目的的奋斗：选定目标、努力争取、评估差距、回到初始步骤。而且那种感觉同其他东西一样，是可以习得的。髓鞘质的其中一个进化优势是，它能够使任何回路绝缘化，甚至是那些一开始我们不喜欢的。在草山，指导员看着学生们体会精深练习的感觉。起初他们并不喜欢。但是很快学生们开始忍受，甚至享受这样的体验。</p>
</li>
</ul>
<h2 id="第二部分-激情"><a href="#第二部分-激情" class="headerlink" title="第二部分 激情"></a>第二部分 激情</h2><ul>
<li><p>精深练习需要时间</p>
</li>
<li><p>这就是激情的工作原理，是那些让我们意识到“我就想成为那样的人”的时刻。人们通常认为激情是一种内心品质。但是我探访的人才温床越多，就越坚信激情首先来自外部世界。在人才温床，正确的蝴蝶拍打翅膀卷起了人才飓风。</p>
</li>
<li><p>他看到这个图表时震惊了。“我不敢相信自己的眼睛。”他说。进步不取决于任何可衡量的天赋或者性格，而是一个微不足道的念头。一个小小的念头却产生了无穷的力量，孩子甚至在学习开始之前就打定了主意，这决定了进步的快慢。不同孩子之间的表现有着惊人的差异。同样的练习时间，给出长期承诺的那组孩子表现得比给出短期承诺的孩子好4倍。</p>
</li>
<li><p>每个信号都与身份和群体有关。每个信号都相当于一盏闪烁的灯，指引人们前进：那些人在做超级有意义的事情。总之，每个信号都针对未来的归属感。</p>
</li>
<li><p>人们都会因为自己与一个成就非凡的群体有联系而感到心潮澎湃。</p>
</li>
<li><p>“如果身处轻松愉快的环境，我们自然而然就会停止努力。”巴特克斯说，“为什么会这样呢？如果人们发现环境很艰苦，马上受到激励。一座管理完善的豪华网球学校给了学员一种豪华未来的体验——学习动机当然也就被压抑了，那是无法避免的。”</p>
</li>
<li><p>丧父或者丧母是一个原始信号：生活不再安全。你不必成为心理学家，也会发现由于缺乏安全感而激发出来的能量储备；你也不必是达尔文主义理论家，也会看到这种反应是如何进化而来的。这个信号可以改变孩子与世界的关系，重新给自己定位，激发和引导自己的大脑去解决危险，处理生命中的可能性。正如基思·西门顿（Keith Simonton）在《天才起源》（Origins of Genius）中提到的，对于父母死亡，“如此不利的事件造就了人格的健全发展，剽悍到使他们足以克服拦在成功道路上的种种障碍和挫折。”</p>
</li>
<li><p>艾森斯塔德名单上的超级名人并非天赋异禀，并非人类中的统计异常值，而是统治所有人的普遍原则的逻辑外延：（1）才能需要精深练习；（2）精深练习需要充分的能量；（3）某些信号会触发巨大能量的迸发。</p>
</li>
<li><p>也不是说，在一个大家庭里出生较晚就必然跑得快，更不是说有位家长在孩子年幼时过世就必然使其能够当上英国首相。但这确实说明，跑得快如同其他才能，受到一堆主要因素的影响，超越基因这个因素，直接相关的是对激励信号强烈的潜意识反应，这种激励信号提供了精深练习所需的能量，从而促进髓鞘质生长。</p>
</li>
<li><p>短短几句话，他成功地点燃了排他性（“我只知道，它很适合汤姆·索亚……我看一千个孩子里面都没有……”）和稀缺性（“男孩子每天都可以刷围栏吗？……波莉姨妈对这围栏的要求太可怕了”）这些原始信号。他的手势以及其他身体语言传达着同样的讯息“盯着他看了一番”以及“一会走远看看效果，随意地在某个地方加上一刷子，又评论一下粉刷效果”——仿佛是在从事最最重要的工作。</p>
</li>
<li><p>精深练习需要深入认真的工作以及热情的劲头。当你开始练习，你不是“打”网球；你在挣扎、在反抗，你需要集中精力，然后慢慢进步。我们的学习像婴儿的蹒跚学步。赞其勤奋的语句之所以有效，是因为它直达学习的核心，而想要点燃激情，没有比这更强大的了。</p>
</li>
</ul>
<h2 id="第三部分-伯乐"><a href="#第三部分-伯乐" class="headerlink" title="第三部分 伯乐"></a>第三部分 伯乐</h2><ul>
<li><p>他们的个性——核心才能的回路——更像农民；如汉斯·詹森那样认真细致的髓鞘质培育者。他们脚踏实地，而且严格自律。拥有广泛而且深刻的知识框架。他们将之应用于培养逐步提升的技能回路，却不掌控最终结果。詹森无法回答我的问题，因为这个问题的核心不符合逻辑。仅仅看见两棵幼苗，就能知道哪一棵会长得更高，这可能吗？唯一的答案是，判断孰优孰劣还为时尚早，他们都还在成长。</p>
</li>
<li><p>优势一：知识矩阵——伯乐的杀手锏</p>
</li>
<li><p>这些深厚的认识，并非与生俱来。同任何技能一样，那是随着时间，通过激情和精深练习逐渐掌握的。[插图]伟大的教练绝不能一蹴而就。我遇到的多数教练拥有类似的人生轨迹：他们曾经在各自的领域意气风发，却不幸受挫，但是他们能够积极寻找原因。</p>
</li>
<li><p>优势二：洞察力——鹰的视力</p>
</li>
<li><p>优势三：简明的指示——神奇的教鞭</p>
</li>
<li><p>优势四：气质与诚信——不可阻挡的魅力</p>
</li>
<li><p>诸如踢足球、写作、喜剧表演这样的技能，需要建立灵活性神经回路，即需要学习者在脑中形成数千条回路，这样就可以轻松地找到一条回路，可以让他绕过变化无常的障碍物。拉小提琴、打高尔夫、体操、花样滑冰这些技能，需要建立一致性神经回路，全靠扎实的技术基础，重现一场完美表演所遵循的基本法则。这就是为什么自学的高尔夫球员、滑冰运动员，还有体操运动员达到世界级水平的鲜有案例，而自学成才的小说家、喜剧演员，还有足球运动员却层出不穷的原因。</p>
</li>
</ul>
<h2 id="后记-一万小时的世界"><a href="#后记-一万小时的世界" class="headerlink" title="后记 一万小时的世界"></a>后记 一万小时的世界</h2><ul>
<li>但是实际上，正如所有的精深练习，一个人首先要克服那种“大事化小，小事化了”的自然倾向——这在企业中尤其困难。</li>
</ul>
<h2 id="译者后记"><a href="#译者后记" class="headerlink" title="译者后记"></a>译者后记</h2><ul>
<li>所以，这不是为那些天生有异象的人写的书，而是送给那些没被上帝的骰子掷中的人的一份补偿。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leeeyou.github.io/iBlogWebsite/2017/04/20/2017/2017-04-20-Android%E4%B9%8B%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAActivity%E5%BC%95%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/6735624?s=460&v=4">
      <meta itemprop="name" content="Leeeyou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leeeyou123">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iBlogWebsite/2017/04/20/2017/2017-04-20-Android%E4%B9%8B%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAActivity%E5%BC%95%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83/" class="post-title-link" itemprop="url">Android之启动一个Activity引发的思考</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-20 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-20T00:00:00+08:00">2017-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-29 20:35:27" itemprop="dateModified" datetime="2022-11-29T20:35:27+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/iBlogWebsite/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在Android中Activity和Service是应用程序的核心组件，它们以松藕合的方式组合在一起构成了一个完整的应用程序，首先这得益于framework层提供了一套完整的机制来协助应用程序启动这些Activity和Service，其次得益于系统提供Binder机制实现进程间通信。这篇日志目的主要是梳理启动一个Activity的核心流程，涉及到哪些进程等。阅读之前需要先了解ActivityManagerServic、ActivityStack、ApplicationThread、ActivityThread以及Binder等概念才不至于一头雾水。</p>
<blockquote>
<p>ActivityRecord：描述了一个Activity所需要的全部信息。<br>TaskRecord：用来记录Activity的任务栈。<br>ActivityStack：用于管理一系列的TaskRecord。<br>ActivityManagerServic：Android系统中最核心的系统服务，主要负责四大组件的启动、切换和调度，以及应用进程的管理和调度工作。<br>ActivityThread：应用程序的主线程，负责主线程Handler的启动以及四大组件的调度和管理。<br>ApplicationThread：ActivityThread的内部类，继承自IApplicationThread.Stub，用于其它进程与它所属应用进程的交互。<br>Binder：Android平台上用于实现IPC的一种机制。</p>
</blockquote>
<h2 id="Activity启动过程的大致步骤"><a href="#Activity启动过程的大致步骤" class="headerlink" title="Activity启动过程的大致步骤"></a>Activity启动过程的大致步骤</h2><ol>
<li><p>无论是通过Launcher来启动Activity，还是通过Activity内部调用startActivity接口来启动新的Activity，<strong>都通过Binder进程间通信进入到ActivityManagerService进程中，并且调用ActivityManagerService.startActivity接口；</strong></p>
</li>
<li><p>ActivityManagerService调用ActivityStack.startActivityMayWait来做准备要启动的Activity的相关信息；</p>
</li>
<li><p>ActivityStack通知ApplicationThread要进行Activity启动调度了，<strong>这里的ApplicationThread代表的是调用ActivityManagerService.startActivity接口的进程，对于通过点击应用程序图标的情景来说，这个进程就是Launcher了，而对于通过在Activity内部调用startActivity的情景来说，这个进程就是这个Activity所在的进程了；</strong></p>
</li>
<li><p>ApplicationThread不执行真正的启动操作，它通过调用ActivityManagerService.activityPaused接口进入到ActivityManagerService进程中，看看是否需要创建新的进程来启动Activity；</p>
</li>
<li><p>对于通过点击应用程序图标来启动Activity的情景来说，ActivityManagerService在这一步中，会调用startProcessLocked来创建一个新的进程，而对于通过在Activity内部调用startActivity来启动新的Activity来说，这一步是不需要执行的，因为新的Activity就在原来的Activity所在的进程中进行启动；</p>
</li>
<li><p>ActivityManagerService调用ApplicationThread.scheduleLaunchActivity接口，通知相应的进程执行启动Activity的操作；</p>
</li>
<li><p>ApplicationThread把这个启动Activity的操作转发给ActivityThread，ActivityThread通过ClassLoader导入相应的Activity类，然后把它启动起来。</p>
</li>
</ol>
<h2 id="7-0系统上AMS启动Activity的核心流程"><a href="#7-0系统上AMS启动Activity的核心流程" class="headerlink" title="7.0系统上AMS启动Activity的核心流程"></a>7.0系统上AMS启动Activity的核心流程</h2><h2 id="8-0系统上AMS启动Activity的核心流程"><a href="#8-0系统上AMS启动Activity的核心流程" class="headerlink" title="8.0系统上AMS启动Activity的核心流程"></a>8.0系统上AMS启动Activity的核心流程</h2><h2 id="从Launcher启动一个应用程序"><a href="#从Launcher启动一个应用程序" class="headerlink" title="从Launcher启动一个应用程序"></a>从Launcher启动一个应用程序</h2><p>下面以启动MainActivity为例来说明Android应用程序的启动过程。从Launcher启动一个应用程序的时序图如下：<br><img src="https://github.com/LeeeYou/Img/blob/master/leeeyou/%E6%A0%B9Activity%E7%9A%84%E5%AE%8C%E6%95%B4%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E5%9B%BE.gif?raw=true" alt="从Launcher启动一个应用程序"></p>
<p>整个应用程序的启动过程要执行很多步骤，但是整体来看，主要分为以下五个阶段：<br>1、Step1 - Step 11：<a target="_blank" rel="noopener" href="http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android-apps/5.1.1_r1/com/android/launcher2/Launcher.java#Launcher.onClick%28android.view.View%29">Launcher</a>通过Binder进程间通信机制通知<a target="_blank" rel="noopener" href="http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.1.1_r1/com/android/server/am/ActivityManagerService.java#ActivityManagerService">ActivityManagerService</a>，它要启动一个<a target="_blank" rel="noopener" href="http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/5.1.1_r1/android/app/Activity.java#Activity">Activity</a>；</p>
<p>2、Step 12 - Step 16：ActivityManagerService通过Binder进程间通信机制通知Launcher进入Paused状态；</p>
<p>3、Step 17 - Step 24：Launcher通过Binder进程间通信机制通知ActivityManagerService，它已经准备就绪进入Paused状态，<strong>于是ActivityManagerService就创建一个新的进程，用来启动一个ActivityThread实例，即将要启动的Activity就是在这个ActivityThread实例中运行；</strong></p>
<p>4、Step 25 - Step 27：ActivityThread通过Binder进程间通信机制将一个ApplicationThread类型的Binder对象传递给ActivityManagerService，以便以后ActivityManagerService能够通过这个Binder对象和它进行通信；</p>
<p>5、Step 28 - Step 35：ActivityManagerService通过Binder进程间通信机制通知ActivityThread，现在一切准备就绪，它可以真正执行Activity的启动操作了。</p>
<p>具体的Step步骤详情可参考：<a target="_blank" rel="noopener" href="http://blog.csdn.net/luoshengyang/article/details/6689748">http://blog.csdn.net/luoshengyang/article/details/6689748</a></p>
<p>ActivityManagerService启动Activity的大致过程</p>
<p><img src="https://github.com/LeeeYou/Img/blob/master/leeeyou/Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%A1%86%E6%9E%B6%E5%B1%82%E4%B8%AD%E7%9A%84ActivityManagerService%E5%90%AF%E5%8A%A8Activity%E7%9A%84%E8%BF%87%E7%A8%8B.gif?raw=true" alt="Android应用程序框架层中的ActivityManagerService启动Activity的过程"></p>
<p><strong>在上面图中，ActivityManagerService和ActivityStack位于同一个进程（SystemServer进程），而ApplicationThread和ActivityThread位于另一个进程中（应用进程）。其中ActivityManagerService负责管理Activity的生命周期，它还借助ActivityStack把所有的Activity按照后进先出的顺序放在一个堆栈中；对每一个应用程序而言都有一个ActivityThread表示应用程序的主线程，而每一个ActivityThread都包含有一个ApplicationThread实例，它是一个Binder对象，负责和其它进程（如SystemServer进程）进行通信。</strong></p>
<h2 id="一点感想"><a href="#一点感想" class="headerlink" title="一点感想"></a>一点感想</h2><hr>
<p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/luoshengyang/article/details/6685853">Android应用程序的Activity启动过程简要介绍和学习计划</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/luoshengyang/article/details/6689748">Android应用程序启动过程源代码分析</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/luoshengyang/article/details/6703247">Android应用程序内部启动Activity过程（startActivity）的源代码分析</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.com/guide/components/tasks-and-back-stack.html">任务与后退栈</a>  </li>
<li><a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/manifest/activity-element.html">activity</a>  </li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/luoshengyang/article/details/8923485">那两年炼就的Android内功修养</a>  </li>
<li><a href="https://leeeyou.github.io/2016/03/05/blog-2016-03-05-Android%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2-%E7%AC%AC9%E7%AB%A0-%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B/">Android艺术探索 第9章 四大组件的工作过程</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/35519585">写给 Android 应用工程师的 Binder 原理剖析</a></li>
</ol>
<p>最后感谢大神中的大神<a target="_blank" rel="noopener" href="http://blog.csdn.net/luoshengyang">罗升阳的博客</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leeeyou.github.io/iBlogWebsite/2017/04/14/2017/2017-04-14-Java%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/6735624?s=460&v=4">
      <meta itemprop="name" content="Leeeyou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leeeyou123">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iBlogWebsite/2017/04/14/2017/2017-04-14-Java%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/" class="post-title-link" itemprop="url">Java之基础知识汇总</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-14 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-14T00:00:00+08:00">2017-04-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-29 20:35:27" itemprop="dateModified" datetime="2022-11-29T20:35:27+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/iBlogWebsite/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Java基本数据类型及其封装类"><a href="#1-Java基本数据类型及其封装类" class="headerlink" title="1. Java基本数据类型及其封装类"></a>1. Java基本数据类型及其封装类</h1><table>
<thead>
<tr>
<th>简单类型</th>
<th>字节数</th>
<th>封装器</th>
</tr>
</thead>
<tbody><tr>
<td>void</td>
<td></td>
<td>void</td>
</tr>
<tr>
<td>boolean</td>
<td>1/8</td>
<td>Boolean</td>
</tr>
<tr>
<td>byte</td>
<td>1</td>
<td>Byte</td>
</tr>
<tr>
<td>char</td>
<td>2</td>
<td>Character</td>
</tr>
<tr>
<td>short</td>
<td>2</td>
<td>Short</td>
</tr>
<tr>
<td>int</td>
<td>4</td>
<td>Integer</td>
</tr>
<tr>
<td>long</td>
<td>8</td>
<td>Long</td>
</tr>
<tr>
<td>float</td>
<td>4</td>
<td>Float</td>
</tr>
<tr>
<td>double</td>
<td>8</td>
<td>Double</td>
</tr>
</tbody></table>
<h1 id="2-Switch能否用string做参数"><a href="#2-Switch能否用string做参数" class="headerlink" title="2. Switch能否用string做参数"></a>2. Switch能否用string做参数</h1><p>在switch(args)中，args只能是一个整数表达式或者枚举常量Enum，整数表达式可以是int基本类型或Integer包装类型，由于byte,short,char都可以隐含转换为int，所以这些类型及其包装类型也是可以的。显然long、float、double类型不符合switch的语法规定，并且不能被隐式转换成int类型，所以它们不能作用于swtich语句中。<strong>注意：String类型是Java7开始支持的。</strong></p>
<h1 id="3-Object有哪些公用方法"><a href="#3-Object有哪些公用方法" class="headerlink" title="3. Object有哪些公用方法"></a>3. Object有哪些公用方法</h1><table>
<thead>
<tr>
<th>方法名</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>equals()</td>
<td>测试的是两个对象是否相等</td>
</tr>
<tr>
<td>hashCode()</td>
<td>返回当前对象的哈希值</td>
</tr>
<tr>
<td>toString()</td>
<td>返回对象的String代表串</td>
</tr>
<tr>
<td>clone()</td>
<td>进行对象拷贝</td>
</tr>
<tr>
<td>getClass()</td>
<td>返回和当前对象相关的Class对象</td>
</tr>
<tr>
<td>notify()、notifyall()、wait()</td>
<td>都是用来对给定对象进行线程同步的</td>
</tr>
<tr>
<td>finalize()</td>
<td>当GC检测到没有引用到此对象时调用</td>
</tr>
</tbody></table>
<h1 id="4-equals-与-的区别"><a href="#4-equals-与-的区别" class="headerlink" title="4. equals 与 == 的区别"></a>4. equals 与 == 的区别</h1><p><strong><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/java/lang/Object.html#equals(java.lang.Object)">Object类中的equals方法和 “==” 是一样的</a></strong> 没有区别，比较内存中存放的对象的堆内存地址，通俗一点说就是比较两个对象是否为同一对象；而String、Integer等一些类是重写了equals方法，加入了自己所需的 “逻辑比较”，才使得equals和 “==” 不同，一个呈现的是逻辑上是否相等，一个呈现的是是否为同一对象。所以当我们创建类时自动继承了Object的equals方法，要想实现不同的等于比较必须重写equals方法。以下是Object类中的equals源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">this</span> == obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leeeyou.test.basic;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by leeeyou on 2017/4/13.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestEquals</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// -128 ~ 127 之间</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">i1</span> <span class="operator">=</span> -<span class="number">129</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">i2</span> <span class="operator">=</span> -<span class="number">129</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(i1 == i2); <span class="comment">//false, 但在 -128 ~ 127 之间是true</span></span><br><span class="line">        System.out.println(i1.intValue());</span><br><span class="line">        System.out.println(i1.equals(i2));<span class="comment">//true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;---&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Float</span> <span class="variable">f1</span> <span class="operator">=</span> <span class="number">.5f</span>;</span><br><span class="line">        <span class="type">Float</span> <span class="variable">f2</span> <span class="operator">=</span> <span class="number">.5f</span>;</span><br><span class="line">        System.out.println(f1 == f2); <span class="comment">//false</span></span><br><span class="line">        System.out.println(Float.floatToIntBits(f1));</span><br><span class="line">        System.out.println(f1.equals(f2));<span class="comment">//true</span></span><br><span class="line">        System.out.println(<span class="string">&quot;---&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Object类中的equals方法和&quot;==&quot;是一样的,比较内存中存放的对象的(堆)内存地址</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o3</span> <span class="operator">=</span> o1;</span><br><span class="line">        System.out.println(o1.equals(o2));<span class="comment">//false</span></span><br><span class="line">        System.out.println(o1 == o2);<span class="comment">//false</span></span><br><span class="line">        System.out.println(o1 == o3);<span class="comment">//true</span></span><br><span class="line">        System.out.println(o1.equals(o3));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">false</span></span><br><span class="line">-<span class="number">129</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line">---</span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="number">1056964608</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line">---</span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h1 id="5-改写equals为什么要改写hashCode"><a href="#5-改写equals为什么要改写hashCode" class="headerlink" title="5. 改写equals为什么要改写hashCode"></a>5. 改写equals为什么要改写hashCode</h1><p>如果不这样的话，就会违反Object.hashCode的通用约定，从而导致该类无法结合所有基于散列的集合一起正常运作，这样的集合包括HashMap、HashSet和HashTable。</p>
<p>下面是约定的内容，摘自Obejct规范[Java SE6]：</p>
<ul>
<li><p>在应用程序执行期间，只要对象的equals方法的比较操作所用到的信息没有被修改，那么对这同一个对象调用多次，hashCode方法都必须始终如一地返回同一个整数。在同一个应用程序的多次执行过程中，每次执行所返回的整数可以不一致。</p>
</li>
<li><p>如果两个对象根据equals(Object)方法比较是相等的，那么调用这两个对象中任意一个对象的hashCode方法都必须产生同样的整数结果。即保证在equals相同的情况下hashcode值必定相同。</p>
</li>
<li><p>如果两个对象根据equals(Object)方法比较是不相等的，那么调用这两个对象中任意一个对象的hashCode方法，则不一定要产生不同的整数结果。但是程序员应该知道，给不相等的对象产生截然不同的整数结果，有可能提高散列表的性能。</p>
</li>
</ul>
<p>参考：<a target="_blank" rel="noopener" href="https://book.douban.com/subject/3360807/">Effective java 中文版（第2版）</a></p>
<h1 id="6-Java的四种引用"><a href="#6-Java的四种引用" class="headerlink" title="6. Java的四种引用"></a>6. Java的四种引用</h1><h2 id="6-1-强引用（StrongReference）"><a href="#6-1-强引用（StrongReference）" class="headerlink" title="6.1. 强引用（StrongReference）"></a>6.1. 强引用（StrongReference）</h2><p>强引用是使用最普遍的引用。<strong>如果一个对象具有强引用那GC绝不会回收它。当内存空间不足，JVM宁愿抛出OutOfMemoryError使程序异常终止，也不会靠随意回收具有强引用的对象来解决内存不足的问题。</strong></p>
<p>Tips：强引用其实也就是我们平时 A a = new A() 这个意思。</p>
<h2 id="6-2-软引用（SoftReference）"><a href="#6-2-软引用（SoftReference）" class="headerlink" title="6.2. 软引用（SoftReference）"></a>6.2. 软引用（SoftReference）</h2><p>如果一个对象只具有软引用，则内存空间足够GC就不会回收它；如果内存空间不足了，就会回收这些对象的内存。软引用可用来实现内存敏感的高速缓存。</p>
<p>软引用可以和一个引用队列（ReferenceQueue）联合使用，如果软引用所引用的对象被GC回收，JVM就会把这个软引用加入到与之关联的引用队列中。</p>
<h2 id="6-3-弱引用（WeakReference）"><a href="#6-3-弱引用（WeakReference）" class="headerlink" title="6.3. 弱引用（WeakReference）"></a>6.3. 弱引用（WeakReference）</h2><p>弱引用与软引用的区别在于：<strong>只具有弱引用的对象拥有更短暂的生命周期。</strong> 在GC线程扫描它所管辖的内存区域时，一旦发现弱引用的对象，不管当前内存空间足够与否，都会回收它的内存。不过由于 <strong>GC是一个优先级很低的线程</strong>，因此不一定会很快发现那些只具有弱引用的对象。</p>
<h2 id="6-4-虚引用（PhantomReference）"><a href="#6-4-虚引用（PhantomReference）" class="headerlink" title="6.4. 虚引用（PhantomReference）"></a>6.4. 虚引用（PhantomReference）</h2><p>与其他几种引用都不同，虚引用并不会决定对象的生命周期。如果一个对象仅持有虚引用，那么它就和没有任何引用一样，在任何时候都可能被GC回收。虚引用主要用来跟踪对象被GC回收。</p>
<p>虚引用与软引用和弱引用的一个区别在于：<strong>虚引用必须和引用队列 （ReferenceQueue）联合使用。</strong> 当GC准备回收一个对象时，如果发现它还有虚引用，就会在回收对象的内存之前，把这个虚引用加入到与之关联的引用队列中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReferenceQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span> ();</span><br><span class="line"><span class="type">PhantomReference</span> <span class="variable">pr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PhantomReference</span> (object, queue);</span><br></pre></td></tr></table></figure>

<p>程序员可以通过判断引用队列中是否已经加入了虚引用，来了解被引用的对象是否为将要被垃圾回收。如果发现某个虚引用已经被加入到引用队列，就可以在所引用对象的内存被回收之前采取必要的行动。</p>
<p>Tips：利用软引用和弱引用解决OOM问题。<br>用一个HashMap来保存图片的路径和相应图片对象关联的软引用之间的映射关系，在内存不足时，JVM会自动回收这些缓存图片对象所占用的空间，从而有效地避免了OOM的问题</p>
<p>Tips：更多关于对象引用的知识，参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-4-jiang-qiang-yin-yong-3001-ruan-yin-yong-3001-ruo-yin-yong-3001-huan-xiang-yin-yong-you-shi-yao-qu-bie-ff1f.md">第4讲 | 强引用、软引用、弱引用、幻象引用有什么区别？</a>。</p>
<h1 id="7-ArrayList、LinkedList、Vector的区别"><a href="#7-ArrayList、LinkedList、Vector的区别" class="headerlink" title="7. ArrayList、LinkedList、Vector的区别"></a>7. ArrayList、LinkedList、Vector的区别</h1><p>下面这张是Collection框架图，主要包含List、Set和Queue集合。<br><img src="../../../../images/githubpages/Java%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/Collection%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E5%9B%BE.png" alt="Collection框架图">  </p>
<p>参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-8-jiang-dui-bi-vector-arraylist-linkedlist-you-he-qu-bie-ff1f.md">第8讲 | 对比Vector、ArrayList、LinkedList有何区别？</a></p>
<h1 id="8-HashMap和ConcurrentHashMap的区别"><a href="#8-HashMap和ConcurrentHashMap的区别" class="headerlink" title="8. HashMap和ConcurrentHashMap的区别"></a>8. HashMap和ConcurrentHashMap的区别</h1><p>下面这张是Map集合框架图。<br><img src="../../../../images/githubpages/Java%E5%9F%BA%E7%A1%80%E6%B1%87%E6%80%BB/Map%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E5%9B%BE.png" alt="Map集合框架图"><br>参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-9-jiang-dui-bi-hashtable-hashmap-treemap-you-shi-yao-bu-tong-ff1f.md">第9讲 | 对比Hashtable、HashMap、TreeMap有什么不同？</a><br>参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-10-jiang-ru-he-baozheng-ji-he-shi-xian-cheng-an-quan-76843f-concurrenthashmap-ru-he-shi-xian-gao-xiao-di-xian-cheng-an-quan-ff1f.md">第10讲 | 如何保证集合是线程安全的? ConcurrentHashMap如何实现高效地线程安全？</a></p>
<h1 id="9-String、StringBuffer与StringBuilder的区别"><a href="#9-String、StringBuffer与StringBuilder的区别" class="headerlink" title="9. String、StringBuffer与StringBuilder的区别"></a>9. String、StringBuffer与StringBuilder的区别</h1><p>String 是 Java 语言非常基础和重要的类，提供了构造和管理字符串的各种基本逻辑。它是典型的 Immutable 类，被声明成为 final class，所有属性也都是 final 的。也由于它的不可变性，类似拼接、裁剪字符串等动作，都会产生新的 String 对象。由于字符串操作的普遍性，所以相关操作的效率往往对应用性能有明显影响。</p>
<p>StringBuffer 是为解决上面提到拼接产生太多中间对象的问题而提供的一个类，它是 Java 1.5 中新增的，我们可以用 append 或者 add 方法，把字符串添加到已有序列的末尾或者指定位置。StringBuffer 本质是一个线程安全的可修改字符序列，它保证了线程安全，也随之带来了额外的性能开销，所以除非有线程安全的需要，不然还是推荐使用它的后继者，也就是 StringBuilder。</p>
<p>StringBuilder 在能力上和 StringBuffer 没有本质区别，但是它去掉了线程安全的部分，有效减小了开销，是绝大部分情况下进行字符串拼接的首选。</p>
<p>Tips：更多知识，参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-5-jiang-string-stringbuffer-stringbuilder-you-shi-yao-qu-bie-ff1f.md">第5讲 | String、StringBuffer、StringBuilder有什么区别？</a></p>
<h1 id="10-try-catch-finally"><a href="#10-try-catch-finally" class="headerlink" title="10. try catch finally"></a>10. try catch finally</h1><p>在不抛出异常的情况下，程序执行完try里面的代码块之后，该方法并不会立即结束，而是继续试图去寻找该方法有没有finally的代码块。</p>
<p>如果没有finally代码块，整个方法在执行完try代码块后返回相应的值来结束整个方法。<br>如果有finally代码块，此时程序执行到try代码块里的return语句之时并不会立即执行return，而是先去执行finally代码块里的代码。</p>
<p>若finally代码块里没有return或没有能够终止程序的代码，程序将在执行完finally代码块代码之后再返回try代码块执行return语句来结束整个方法。<br>若finally代码块里有return或含有能够终止程序的代码，方法将在执行完finally之后被结束，不再跳回try代码块执行return。</p>
<p>在抛出异常的情况下，原理也是和上面的一样的，你把上面说到的try换成catch去理解就OK了。</p>
<h1 id="11-Excption与Error包结构"><a href="#11-Excption与Error包结构" class="headerlink" title="11. Excption与Error包结构"></a>11. Excption与Error包结构</h1><p><img src="https://github.com/LeeeYou/Img/blob/master/leeeyou/Excption.png?raw=true" alt="Throwable"></p>
<p>参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-2-jiang-exception-he-error-you-shi-yao-qu-bie-ff1f.md">第2讲 | Exception和Error有什么区别？</a></p>
<h1 id="12-锁的等级"><a href="#12-锁的等级" class="headerlink" title="12. 锁的等级"></a>12. 锁的等级</h1><h2 id="12-1-分类"><a href="#12-1-分类" class="headerlink" title="12.1. 分类"></a>12.1. 分类</h2><p>类锁：在代码中的方法上加了static和synchronized的锁，或者synchronized(xxx.class）的代码段。<br>对象锁：在代码中的方法上加上synchronized锁或者synchronized(this）的代码段，二者的加锁方法构成竞争关系，同一时刻只能有一个方法能执行。<br>私有锁：在类内部声明一个私有属性如private Object lock，在需要加锁的代码段synchronized(lock）。      </p>
<p>类锁和对象锁不会产生竞争，二者的加锁方法不会相互影响。<br>私有锁和对象锁也不会产生竞争，二者的加锁方法不会相互影响。</p>
<h2 id="12-2-synchronized和lock区别"><a href="#12-2-synchronized和lock区别" class="headerlink" title="12.2. synchronized和lock区别"></a>12.2. synchronized和lock区别</h2><p>Lock是Java SE5中新引入的用于提高性能的类，类似的还有Atomic类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Lock</span> <span class="variable">l</span> <span class="operator">=</span> ...;</span><br><span class="line">l.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// access the resource protected by this lock</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  l.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要考虑两个因素：1 互斥方法体的大小问题。<strong>只互斥那些绝对必须互斥的部分</strong> ，但实际情况中，被互斥部分可能非常大，相对于进入和退出互斥的时间比来说，Lock提升的互斥速度优势基本就湮灭了； 2 synchronized的可读性高，维护成本较低，通常是开发人员的惯用手法。建议以synchronized入手，只有在性能调优时或者 <strong>有明确的证据表明</strong> 在同步下synchronized遇到性能瓶颈才替换为Lock这种做法具有实际意义。</p>
<p>Tips：更多知识，参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-15-jiang-synchronized-he-reentrantlock-you-shi-yao-qu-bie-ni-ff1f.md">第15讲 | synchronized和ReentrantLock有什么区别呢？</a></p>
<h1 id="13-生产者消费者模式"><a href="#13-生产者消费者模式" class="headerlink" title="13. 生产者消费者模式"></a>13. 生产者消费者模式</h1><p>下面这段代码的实现方式比较复杂，需要人为控制轮询和条件判断。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.day12.proCus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解决了&quot;重复消费和未消费&quot;的问题(if改成while)，同时利用JDK5.0新特性Lock和Condition 处理了同步时上锁解锁和等待唤醒的的问题</span></span><br><span class="line"><span class="comment"> * Lock最大的一个特点是：&quot;可以支持多个相关的 Condition 对象&quot;，也就是说一把锁上可以绑定多个&quot;状态条件&quot;对象，详见API</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kongbei</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerCustomerDemo2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Res2</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Res2</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Producer2</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer2</span>(r);</span><br><span class="line">        <span class="type">Customer2</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer2</span>(r);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(p);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(c);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(p);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(c);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        t4.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Res2 r;</span><br><span class="line"></span><br><span class="line">    Producer2(Res2 r) &#123;</span><br><span class="line">        <span class="built_in">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        r.set(<span class="string">&quot;iPhone5s&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Customer2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Res2 r;</span><br><span class="line"></span><br><span class="line">    Customer2(Res2 r) &#123;</span><br><span class="line">        <span class="built_in">this</span>.r = r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        r.print();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Res2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">5588</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//当前仓库是不是满的</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">conditon_pro</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition_cus</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            lock.lock(); <span class="comment">//上锁</span></span><br><span class="line">            <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conditon_pro.await(); <span class="comment">//让生产线程等待</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.name = name + <span class="string">&quot;..编号&quot;</span> + count++;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;- 生产 -&quot;</span> + <span class="built_in">this</span>.name);</span><br><span class="line">            flag = <span class="literal">true</span>;</span><br><span class="line">            condition_cus.signal(); <span class="comment">//唤醒消费线程</span></span><br><span class="line">            lock.unlock();<span class="comment">//解锁</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            lock.lock(); <span class="comment">//上锁</span></span><br><span class="line">            <span class="keyword">while</span> (!flag) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    condition_cus.await();<span class="comment">//让消费线程等待</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;	&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;-消费-&quot;</span> + name);</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">            conditon_pro.signal();<span class="comment">//唤醒生成线程</span></span><br><span class="line">            lock.unlock();<span class="comment">//解锁</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面利用 BlockingQueue 来实现，由于其提供的等待机制，我们可以少操心很多协调工作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerProducer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXIT_MSG</span> <span class="operator">=</span> <span class="string">&quot;Good bye!&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用较小的队列，以更好地在输出中展示其影响</span></span><br><span class="line">        BlockingQueue&lt;String&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(queue);</span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Consumer</span>(queue);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(producer).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(consumer).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> BlockingQueue&lt;String&gt; queue;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(BlockingQueue&lt;String&gt; q)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.queue = q;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">5L</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;Message&quot;</span> + i;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Produced new item: &quot;</span> + msg);</span><br><span class="line">                    queue.put(msg);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Time to say good bye!&quot;</span>);</span><br><span class="line">                queue.put(EXIT_MSG);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> BlockingQueue&lt;String&gt; queue;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(BlockingQueue&lt;String&gt; q)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.queue = q;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                String msg;</span><br><span class="line">                <span class="keyword">while</span> (!EXIT_MSG.equalsIgnoreCase((msg = queue.take()))) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;    Consumed item: &quot;</span> + msg);</span><br><span class="line">                    Thread.sleep(<span class="number">10L</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;Got exit message, bye!&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Tips：更多知识，参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-20-jiang-bing-fa-bao-zhong-de-concurrentlinkedqueue-he-linkedblockingqueue-you-shi-yao-qu-bie-ff1f.md#%E9%98%9F%E5%88%97%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%8E%E5%85%B8%E5%9E%8B%E7%94%A8%E4%BE%8B">第20讲 | 并发包中的ConcurrentLinkedQueue和LinkedBlockingQueue有什么区别？</a></p>
<h1 id="14-写一个死锁程序"><a href="#14-写一个死锁程序" class="headerlink" title="14. 写一个死锁程序"></a>14. 写一个死锁程序</h1><p>出现原因：同步中嵌套同步</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.day11.deadLock;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadLock</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">DeadLock2</span>(<span class="literal">false</span>));</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">DeadLock2</span>(<span class="literal">true</span>));</span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DeadLock2</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">  <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">  DeadLock2(<span class="type">boolean</span> flag)&#123;</span><br><span class="line">    <span class="built_in">this</span>.flag = flag;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">     <span class="keyword">synchronized</span> (LockObject.lo1) &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;if lo1&quot;</span>);</span><br><span class="line">       <span class="keyword">synchronized</span> (LockObject.lo2) &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;if lo2&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">synchronized</span> (LockObject.lo2) &#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;else lo2&quot;</span>);</span><br><span class="line">       <span class="keyword">synchronized</span> (LockObject.lo1) &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;else lo1&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LockObject</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="type">LockObject</span> <span class="variable">lo1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LockObject</span>();</span><br><span class="line">  <span class="keyword">static</span> <span class="type">LockObject</span> <span class="variable">lo2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LockObject</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Tips：更多知识，参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-18-jiang-shi-yao-qing-kuang-xia-java-cheng-xu-hui-chan-sheng-si-suo-ff1f-ru-he-ding-wei-3001-xiu-fu-ff1f.md">第18讲 | 什么情况下Java程序会产生死锁？如何定位、修复？</a></p>
<h1 id="15-ThreadLocal"><a href="#15-ThreadLocal" class="headerlink" title="15. ThreadLocal"></a>15. ThreadLocal</h1><p><strong>ThreadLocal是一个数据结构，用于隔离其他线程，提供线程内的局部变量；这种变量在线程的生命周期内起作用，能减少同一个线程内多个函数或者组件之间一些公共变量传递的复杂度。</strong></p>
<p>先看看JDK8的ThreadLocal-set/get方法的源码：</p>
<p><a target="_blank" rel="noopener" href="https://cs.android.com/android/platform/superproject/+/master:libcore/ojluni/src/main/java/java/lang/ThreadLocal.java;l=455;drc=master?q=ThreadLocalMap&ss=android/platform/superproject"><strong>libcore/ojluni/src/main/java/java/lang/ThreadLocal.java</strong></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="comment">//获取当前线程</span></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="comment">//拿到当前线程的ThreadLocalMap，实际上就是Thread类的threadLocals属性</span></span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> <span class="built_in">this</span>.getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">        <span class="comment">//key是ThreadLocal本身</span></span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//在ThreadLocalMap中找到对应的Entry</span></span><br><span class="line">        ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> map.getEntry(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            <span class="comment">//得到Entry的value</span></span><br><span class="line">            <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ThreadLocal.ThreadLocalMap <span class="title function_">getMap</span><span class="params">(Thread t)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> t.threadLocals;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现，每个线程中都有一个ThreadLocalMap数据结构。当执行set方法时，其值是保存在当前线程的threadLocals变量中；而执行get方法中是从当前线程的threadLocals变量获取。通过下面的例子可以更好的理解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal&lt;String&gt; cityName = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>();</span><br><span class="line"></span><br><span class="line">在Thread1中cityName.set(<span class="string">&quot;深圳&quot;</span>);</span><br><span class="line">在Thread2中cityName.set(<span class="string">&quot;北京&quot;</span>);</span><br><span class="line"></span><br><span class="line">Thread1 - ThreadLocalMap1(key,value) - key就是ThreadLocal实例，value就是深圳</span><br><span class="line">Thread2 - ThreadLocalMap2(key,value) - key就是ThreadLocal实例，value就是北京</span><br></pre></td></tr></table></figure>

<p>总结一下ThreadLocal的设计思路：每个Thread维护一个ThreadLocalMap映射表，这个映射表的key是ThreadLocal实例本身，value是真正需要存储的Object。所以在Thread1中set的值，对Thread2来说是摸不到的，而且在Thread2中重新set的话，也不会影响到Thread1中的值，保证了线程之间不会相互干扰。</p>
<h2 id="15-1-Android中ThreadLocal唯一性验证"><a href="#15-1-Android中ThreadLocal唯一性验证" class="headerlink" title="15.1 Android中ThreadLocal唯一性验证"></a>15.1 <a target="_blank" rel="noopener" href="https://github.com/Leeeyou/SampleHandler/blob/master/app/src/main/java/com/leeeyou123/samplehandler/MainActivity.kt">Android中ThreadLocal唯一性验证</a></h2><p>结合Android中的Handler机制中的Looper是如何保证线程唯一性的，下面代码分别在主线程和子线程中反射获取sThreadLocal和mQueue，然后观察它们是否一致。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 验证ThreadLocal全局唯一性，分别在主线程和子线程中反射获取sThreadLocal和mQueue，然后观察它们是否一致</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* 期望：sThreadLocal一致，完全是同一个实例对象，因为它是static final的，隶属于类</span></span><br><span class="line"><span class="comment">*      而mQueue是final的，是跟线程实例对象对应的，不同线程是不同的实例对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">verifyThreadLocal</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;请查看logcat&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> looperClazz = Class.forName(<span class="string">&quot;android.os.Looper&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在主线程中反射获取sThreadLocal和mQueue对象</span></span><br><span class="line">    Looper.getMainLooper()?.also &#123;</span><br><span class="line">        Handler(it).post &#123;</span><br><span class="line">            <span class="keyword">val</span> threadLocalField = looperClazz.getDeclaredField(<span class="string">&quot;sThreadLocal&quot;</span>)</span><br><span class="line">            <span class="keyword">val</span> mqField = looperClazz.getDeclaredField(<span class="string">&quot;mQueue&quot;</span>)</span><br><span class="line">            threadLocalField.isAccessible = <span class="literal">true</span></span><br><span class="line">            mqField.isAccessible = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">val</span> threadLocalObj = threadLocalField.<span class="keyword">get</span>(<span class="literal">null</span>) <span class="comment">// 获取静态类型的实例对象</span></span><br><span class="line">            <span class="keyword">val</span> mqObj = mqField.<span class="keyword">get</span>(it)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">val</span> msg =</span><br><span class="line">                <span class="string">&quot;ThreadName [<span class="subst">$&#123;Thread.currentThread().name&#125;</span>], sThreadLocal is [<span class="subst">$&#123;threadLocalObj&#125;</span>], mQueue is [<span class="subst">$&#123;mqObj&#125;</span>]&quot;</span></span><br><span class="line">            Log.e(TAG, msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在子线程中反射获取sThreadLocal和mQueue对象</span></span><br><span class="line">    Thread &#123;</span><br><span class="line">        Looper.prepare() <span class="comment">// 子线程中prepare looper</span></span><br><span class="line">        Looper.myLooper()?.also &#123;</span><br><span class="line">            Handler(it).post &#123; <span class="comment">// 在子线程中创建Handler并post msg</span></span><br><span class="line">                <span class="keyword">val</span> threadLocalField = looperClazz.getDeclaredField(<span class="string">&quot;sThreadLocal&quot;</span>)</span><br><span class="line">                <span class="keyword">val</span> mqField = looperClazz.getDeclaredField(<span class="string">&quot;mQueue&quot;</span>)</span><br><span class="line">                threadLocalField.isAccessible = <span class="literal">true</span></span><br><span class="line">                mqField.isAccessible = <span class="literal">true</span></span><br><span class="line">                <span class="keyword">val</span> threadLocalObj = threadLocalField.<span class="keyword">get</span>(<span class="literal">null</span>) <span class="comment">// 获取静态类型的实例对象</span></span><br><span class="line">                <span class="keyword">val</span> mqObj = mqField.<span class="keyword">get</span>(it)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">val</span> msg =</span><br><span class="line">                    <span class="string">&quot;ThreadName [<span class="subst">$&#123;Thread.currentThread().name&#125;</span>], sThreadLocal is [<span class="subst">$&#123;threadLocalObj&#125;</span>], mQueue is [<span class="subst">$&#123;mqObj&#125;</span>]&quot;</span></span><br><span class="line">                Log.e(TAG, msg)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Looper.loop() <span class="comment">// 开启子线程的loop循环</span></span><br><span class="line">    &#125;.start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出的日志如下所示，可以看到不管是主线程还是子线程，sThreadLocal是同一个实例对象，而mQueue是跟线程实例对象对应的，不同线程是不同的实例对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2021</span>-<span class="number">12</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">12</span>:<span class="number">38.550</span> <span class="number">8100</span>-<span class="number">8100</span>/com.leeeyou123.samplehandler E/MainActivity: ThreadName [main], sThreadLocal is [java.lang.ThreadLocal@8a18755], mQueue is [android.os.MessageQueue@74fba5b]</span><br><span class="line"><span class="number">2021</span>-<span class="number">12</span>-<span class="number">16</span> <span class="number">15</span>:<span class="number">12</span>:<span class="number">38.550</span> <span class="number">8100</span>-<span class="number">11638</span>/com.leeeyou123.samplehandler E/MainActivity: ThreadName [Thread-<span class="number">12</span>], sThreadLocal is [java.lang.ThreadLocal@8a18755], mQueue is [android.os.MessageQueue@51c42f8]</span><br></pre></td></tr></table></figure>

<h2 id="15-2-ThreadLocalMap"><a href="#15-2-ThreadLocalMap" class="headerlink" title="15.2. ThreadLocalMap"></a>15.2. <a target="_blank" rel="noopener" href="https://cs.android.com/android/platform/superproject/+/master:libcore/ojluni/src/main/java/java/lang/ThreadLocal.java;drc=master;bpv=1;bpt=1;l=298?q=ThreadLocalMap&ss=android/platform/superproject">ThreadLocalMap</a></h2><p>从名字上看可以猜到它也是一个类似HashMap的数据结构，但是在ThreadLocal中并没实现Map接口。在ThreadLoalMap中初始化一个大小16的Entry数组，Entry对象用来保存每一个key-value键值对，只不过这里的key永远都是ThreadLocal对象，是不是很神奇，通过ThreadLocal对象的set方法，结果把ThreadLocal对象自己当做key，放进了ThreadLoalMap中。</p>
<p>ThreadLoalMap的Entry继承了WeakReference，和HashMap很大的区别是，Entry中没有next字段，所以就不存在链表的情况了。</p>
<p>ThreadLocalMap是使用ThreadLocal的弱引用作为Key的，源码如下所示：</p>
<p><strong>libcore/ojluni/src/main/java/java/lang/ThreadLocal.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalMap</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">        <span class="comment">/** The value associated with this ThreadLocal. */</span></span><br><span class="line">        Object value;</span><br><span class="line"></span><br><span class="line">        Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">            <span class="built_in">super</span>(k);</span><br><span class="line">            value = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="hash冲突"><a href="#hash冲突" class="headerlink" title="hash冲突"></a><a target="_blank" rel="noopener" href="https://cs.android.com/android/platform/superproject/+/master:libcore/ojluni/src/main/java/java/lang/ThreadLocal.java;drc=master;bpv=1;bpt=1;l=455?q=ThreadLocalMap&ss=android/platform/superproject">hash冲突</a></h3><p>没有链表结构，那发生hash冲突了怎么办？先看看ThreadLoalMap中插入一个key-value的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(ThreadLocal&lt;?&gt; key, Object value)</span> &#123;</span><br><span class="line">    <span class="comment">//拿到Entry数组</span></span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line">    <span class="comment">//通过ThreadLocal对象的hash值计算出下标</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> key.threadLocalHashCode &amp; (len-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//循环数组，起点是i所在的位置</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> tab[i];</span><br><span class="line">            e != <span class="literal">null</span>;</span><br><span class="line">            e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">        ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//位置i已经有Entry对象了，如果这个Entry对象的key正好是即将设置的key，那么重新设置Entry中的value</span></span><br><span class="line">        <span class="keyword">if</span> (k == key) &#123;</span><br><span class="line">            e.value = value;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//位置i的key是null，则替换掉陈旧的Entry</span></span><br><span class="line">        <span class="keyword">if</span> (k == <span class="literal">null</span>) &#123;</span><br><span class="line">            replaceStaleEntry(key, value, i);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当前i的位置是null，正在就初始化一个Entry放在i位置上</span></span><br><span class="line">    tab[i] = <span class="keyword">new</span> <span class="title class_">Entry</span>(key, value);</span><br><span class="line">    <span class="type">int</span> <span class="variable">sz</span> <span class="operator">=</span> ++size;</span><br><span class="line">    <span class="keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)</span><br><span class="line">        rehash();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每个ThreadLocal对象都有一个hash值threadLocalHashCode，每初始化一个ThreadLocal对象，hash值就增加一个固定的大小0x61c88647(即十进制1640531527)。上面的set代码展示了插入过程中的定位逻辑，在get的时候，也会根据ThreadLocal对象的hash值，定位到table中的位置，然后判断该位置Entry对象中的key是否和get的key一致，如果不一致，就判断下一个位置。</p>
<h2 id="15-3-ThreadLocal和Synchronized"><a href="#15-3-ThreadLocal和Synchronized" class="headerlink" title="15.3. ThreadLocal和Synchronized"></a>15.3. ThreadLocal和Synchronized</h2><p>一个是锁机制进行时间换空间，一个是存储拷贝进行空间换时间。</p>
<h1 id="16-守护线程和非守护线程的区别以及用法"><a href="#16-守护线程和非守护线程的区别以及用法" class="headerlink" title="16. 守护线程和非守护线程的区别以及用法"></a>16. 守护线程和非守护线程的区别以及用法</h1><p>调用时机：在启动线程前调用。<br>特点一：开启后，和前台线程共同抢夺CPU执行权并运行。<br>特点二：结束时，当所有前台线程都结束后，后台线程会自动结束（JAVA VM退出）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.day12.deamonThread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeamonThreadDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DeamonThread</span> <span class="variable">dt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeamonThread</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(dt);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(dt);</span><br><span class="line"></span><br><span class="line">        t1.setDaemon(<span class="literal">true</span>);<span class="comment">//设置为后台线程</span></span><br><span class="line">        t2.setDaemon(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;..&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DeamonThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;..&quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="17-ThreadPool用法与优势"><a href="#17-ThreadPool用法与优势" class="headerlink" title="17. ThreadPool用法与优势"></a>17. ThreadPool用法与优势</h1><h2 id="17-1-优势"><a href="#17-1-优势" class="headerlink" title="17.1. 优势"></a>17.1. 优势</h2><p>降低资源消耗：通过重复利用已创建的线程降低线程创建和销毁造成的消耗。<br>提高响应速度：当任务到达时，任务可以不需要等到线程创建就能立即执行。<br>提高线程的可管理性：线程是稀缺资源，如果无限制的创建，不仅会消耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控。</p>
<h2 id="17-2-newCachedThreadPool"><a href="#17-2-newCachedThreadPool" class="headerlink" title="17.2. newCachedThreadPool"></a>17.2. newCachedThreadPool</h2><p>创建一个可缓存线程池，如果线程池长度超过处理需要，可灵活回收空闲线程，若无可回收，则新建线程。<br>只有非核心线程；线程数量不固定的线程池；有超时机制，超过60s，闲置线程就会被回收；适合执行大量的耗时较少的任务。</p>
<h2 id="17-3-newFixedThreadPool"><a href="#17-3-newFixedThreadPool" class="headerlink" title="17.3. newFixedThreadPool"></a>17.3. newFixedThreadPool</h2><p>创建一个定长线程池，可控制线程最大并发数，超出的线程会在队列中等待。<br>只有核心线程；线程数量固定的线程池；线程处于空闲状态，不会被回收。</p>
<h2 id="17-4-newScheduledThreadPool"><a href="#17-4-newScheduledThreadPool" class="headerlink" title="17.4. newScheduledThreadPool"></a>17.4. newScheduledThreadPool</h2><p>创建一个定长线程池，支持定时及周期性任务执行。<br>核心线程有固定数，非核心线程没有限制的线程池；非核心线程闲置时会被回收；主要用于执行定时任务和具有固定周期的重复任务。</p>
<h2 id="17-5-newSingleThreadExecutor"><a href="#17-5-newSingleThreadExecutor" class="headerlink" title="17.5. newSingleThreadExecutor"></a>17.5. newSingleThreadExecutor</h2><p>创建一个单线程化的线程池，它只会用唯一的工作线程来执行任务，保证所有任务按照指定顺序(FIFO, LIFO, 优先级)执行。<br>只有一个核心线程；确保所有的任务都在同一个线程中按顺序执行；其意义在于统一外界任务到一个线程中，使得这些任务之间不需要处理线程同步问题。</p>
<p>Tips：更多知识，参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-21-jiang-java-bing-fa-lei-ku-ti-gong-de-xian-cheng-chi-you-na-ji-zhong-ff1f-fen-bie-you-shi-yao-te-dian-ff1f.md">第21讲 | Java并发类库提供的线程池有哪几种？ 分别有什么特点？</a></p>
<h1 id="18-Java-IO与NIO"><a href="#18-Java-IO与NIO" class="headerlink" title="18. Java IO与NIO"></a>18. Java IO与NIO</h1><table>
<thead>
<tr>
<th>IO</th>
<th>NIO</th>
</tr>
</thead>
<tbody><tr>
<td>面向流</td>
<td>面向缓冲</td>
</tr>
<tr>
<td>阻塞IO</td>
<td>非阻塞IO</td>
</tr>
<tr>
<td>无</td>
<td>选择器</td>
</tr>
</tbody></table>
<h2 id="18-1-面向流-vs-面向缓冲"><a href="#18-1-面向流-vs-面向缓冲" class="headerlink" title="18.1. 面向流 vs 面向缓冲"></a>18.1. 面向流 vs 面向缓冲</h2><p>Java NIO和IO之间第一个最大的区别是，IO是面向流的，NIO是面向缓冲区的。</p>
<p>Java IO面向流意味着每次从流中读一个或多个字节，直至读取所有字节，它们没有被缓存在任何地方。此外它不能前后移动流中的数据，如果需要前后移动从流中读取的数据，需要先将它缓存到一个缓冲区。</p>
<p>Java NIO的缓冲导向方法略有不同，数据读取到一个它稍后处理的缓冲区，需要时可在缓冲区中前后移动。这就增加了处理过程中的灵活性，但还需要检查是否该缓冲区中包含所有您需要处理的数据，而且需确保当更多的数据读入缓冲区时，不要覆盖缓冲区里尚未处理的数据。</p>
<h2 id="18-2-阻塞-vs-非阻塞"><a href="#18-2-阻塞-vs-非阻塞" class="headerlink" title="18.2. 阻塞 vs 非阻塞"></a>18.2. 阻塞 vs 非阻塞</h2><p>Java IO的各种流是阻塞的。这意味着当一个线程调用read()或write()时，该线程被阻塞直到有一些数据被读取或数据完全写入。该线程在此期间不能再干任何事情了。</p>
<p>Java NIO的非阻塞模式，一个线程从某通道发送请求读取数据，但是它仅能得到目前可用的数据，如果目前没有数据可用时，就什么都不会获取，而不是保持线程阻塞，所以直至数据变的可以读取之前，该线程可以继续做其他的事情。非阻塞写也是如此，一个线程请求写入一些数据到某通道，但不需要等待它完全写入，这个线程同时可以去做别的事情。线程通常将非阻塞IO的空闲时间用于在其它通道上执行IO操作，所以一个单独的线程现在可以管理多个输入和输出通道（channel）。</p>
<h2 id="18-3-事件监听器"><a href="#18-3-事件监听器" class="headerlink" title="18.3. 事件监听器"></a>18.3. 事件监听器</h2><p>Java NIO的选择器(Selector)允许一个单独的线程来监视多个输入通道(Channel)，我们在Selector上声明我们关心哪一个Channel的什么事件， Selector会监控这些Channels，并在事件发生时通知我们。</p>
<p>Tips：更多知识，参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-11-jiang-java-ti-gong-le-na-xie-io-fang-shi-ff1f-nio-ru-he-shi-xian-duo-lu-fu-yong-ff1f.md">第11讲 | Java提供了哪些IO方式？ NIO如何实现多路复用？</a></p>
<h1 id="19-接口和抽象类的区别"><a href="#19-接口和抽象类的区别" class="headerlink" title="19. 接口和抽象类的区别"></a>19. 接口和抽象类的区别</h1><p>Tips：更多知识，参考 <a target="_blank" rel="noopener" href="https://github.com/LeeeYou/The-core-of-Java-36/blob/master/di-13-jiang-tan-tan-jie-kou-he-chou-xiang-lei-you-shi-yao-qu-bie-ff1f.md">第13讲 | 谈谈接口和抽象类有什么区别？</a></p>
<h1 id="20-静态类和非静态类的区别"><a href="#20-静态类和非静态类的区别" class="headerlink" title="20. 静态类和非静态类的区别"></a>20. 静态类和非静态类的区别</h1><p>静态类不能实例化，非静态类在使用时必须要实例化。</p>
<p>静态类中不能创建非静态的方法，即静态类中只能创建静态方法，但在非静态类中可以调用静态方法。</p>
<p>静态内部类可以有静态成员(方法，属性)，而非静态内部类则不能有静态成员(方法，属性)。</p>
<p>静态内部类只能够访问外部类的静态成员,而非静态内部类则可以访问外部类的所有成员(方法，属性)。</p>
<p>实例化一个非静态的内部类的方法 :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a.先生成一个外部类对象实例</span><br><span class="line"><span class="type">OutClassTest</span> <span class="variable">oc1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutClassTest</span>();</span><br><span class="line"></span><br><span class="line">b.通过外部类的对象实例生成内部类对象</span><br><span class="line">OutClassTest.<span class="type">InnerClass</span> <span class="variable">no_static_inner</span> <span class="operator">=</span> oc1.<span class="keyword">new</span> <span class="title class_">InnerClass</span>();</span><br></pre></td></tr></table></figure>

<p>实例化一个静态内部类的方法 :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a.不依赖于外部类的实例,直接实例化内部类对象</span><br><span class="line">OutClassTest.<span class="type">InnerStaticClass</span> <span class="variable">inner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutClassTest</span>.InnerStaticClass();</span><br><span class="line"></span><br><span class="line">b.调用内部静态类的方法或静态变量,通过类名直接调用</span><br><span class="line">OutClassTest.InnerStaticClass.static_value</span><br><span class="line">OutClassTest.InnerStaticClass.getMessage()</span><br></pre></td></tr></table></figure>

<h1 id="21-父类、子类实例化顺序"><a href="#21-父类、子类实例化顺序" class="headerlink" title="21. 父类、子类实例化顺序"></a>21. 父类、子类实例化顺序</h1><p>当实例化子类对象时，首先要加载父类的class文件进内存，静态代码块是随着类的创建而执行，所以父类静态代码块最先被执行，子类class文件再被加载，同理静态代码块被先执行；实例化子类对象要先调用父类的构造方法，而调用父类构造方法前会先执行父类的非静态代码块。</p>
<p>例如：子类Sub继承父类Parent，Parent a = new Sub(); 则父类B构造函数、父类B静态代码块、父类B非静态代码块、子类A构造函数、子类A静态代码块、子类A非静态代码块 执行的先后顺序是？</p>
<p>父类静态代码块-&gt;子类静态代码块-&gt;父类非静态代码块-&gt;父类构造函数-&gt;子类非静态代码块-&gt;子类构造函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ParentCodeBlock 静态代码块</span><br><span class="line">SubBlockParent 静态代码块</span><br><span class="line">ParentCodeBlock 非静态代码块</span><br><span class="line">ParentCodeBlock 构造函数</span><br><span class="line">SubBlockParent 非静态代码块</span><br><span class="line">SubBlockParent 构造函数</span><br></pre></td></tr></table></figure>

<h1 id="22-OOP和AOP的区别"><a href="#22-OOP和AOP的区别" class="headerlink" title="22. OOP和AOP的区别"></a>22. OOP和AOP的区别</h1><p>OOP(面向对象编程)针对业务处理过程的实体及其属性和行为进行封装，以获得更加清晰的逻辑单元划分。</p>
<p>AOP则是针对业务处理过程中的切面进行提取，它所面对的是处理过程中的某个步骤或阶段，以获得逻辑过程中各部分之间低耦合性的隔离效果。AOP可以通过 <strong>预编译方式和运行期动态代理</strong> 实现在不修改源代码的情况下给程序动态统一添加功能的一种技术，把散落在程序中的公共部分提取出来做成切面类，这样的好处在于代码的可重用，一旦涉及到该功能的需求发生变化，只要修改该代码就行，否则你要到处修改，如果只要修改1、2处那还可以接受，万一有1000处呢？</p>
<h1 id="23-依赖注入和控制反转的区别"><a href="#23-依赖注入和控制反转的区别" class="headerlink" title="23. 依赖注入和控制反转的区别"></a>23. 依赖注入和控制反转的区别</h1><p>依赖注入，就其广义而言即是通过 “注入” 的方式来获得依赖。我们知道，A对象依赖于B对象，等价于A对象内部存在对B对象的 “调用”，而前提是A对象内部拿到了B对象的引用。B对象的引用的来源无非有以下几种：A对象内部创建（无论是作为字段还是作为临时变量）、构造器注入、属性注入、方法注入。后面三种方式统称为“依赖注入”，而第一种方式我也生造了一个名词，称为 “依赖内生” 。二者根本的差异即在于：我所依赖的对象的创建工作是否由我自己来完成。</p>
<p>控制反转跟依赖倒置都是一种编程思想，依赖倒置着眼于调用的形式，而控制反转则着眼于程序流程的控制权。一般来说，程序的控制权属于Client，而一旦控制权交到server，就叫控制反转。比如你去下馆子，你是Client餐馆是server。你点菜，餐馆负责做菜，程序流程的控制权属于Client；而如果你去自助餐厅，程序流程的控制权就转到server了，也就是控制反转。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leeeyou.github.io/iBlogWebsite/2017/04/01/2017/2017-04-01-Android%E4%B9%8B%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6%E6%95%B4%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/6735624?s=460&v=4">
      <meta itemprop="name" content="Leeeyou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leeeyou123">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iBlogWebsite/2017/04/01/2017/2017-04-01-Android%E4%B9%8B%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6%E6%95%B4%E7%90%86/" class="post-title-link" itemprop="url">Android之自定义控件整理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-01 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-01T00:00:00+08:00">2017-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-29 20:35:27" itemprop="dateModified" datetime="2022-11-29T20:35:27+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/iBlogWebsite/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-view的绘制过程"><a href="#1-view的绘制过程" class="headerlink" title="1. view的绘制过程"></a>1. view的绘制过程</h1><p>首先还是有必要谈下view的绘制过程，这里不得不提ViewRoot，ViewRoot对应ViewRootImpl类，是连接WindowManager和DecorView的纽带。View的三大流程均是通过ViewRoot来完成的。</p>
<p>同时View的绘制流程从ViewRoot的performTraversals开始，经过measure，layout，draw三个过程才能最终将一个View绘制出来。简单来说measure用来测量View的宽和高，layout用来确定View在父容器中放置的位置，而draw则负责将View绘制在屏幕上。</p>
<p>总体绘制流程如下：</p>
<ul>
<li>measure过程决定了View的宽/高，measure完成以后，可以通过getMeasureWidth和getMeasureHeight方法来获取到View测量后的宽/高，<strong>在几乎所有情况下它都等同于View的最终宽高</strong>，但是特殊情况下后面讨论。  </li>
<li>layout过程决定了view的四个顶点的坐标和实际的view的宽高，完成以后，可以通过getTop，getBottom,getLeft,getRight来拿到view的四个顶点的位置，并可以通过getWidth和getHeight方法来拿到view的最终宽高。</li>
<li>draw过程则决定了view的显示，只有draw方法完成以后view的内容才能呈现在屏幕上。</li>
</ul>
<p>上面提及的特殊情况如下：</p>
<ul>
<li>重写view的onLayout方法，就能使测量宽高不等于最终宽高</li>
<li>另一种情况，view需要多次measure才能确定自己的测量宽高，在前几次的测量过程中，其得出的测量宽高有可能和最终宽高不一致，但最终来说，测量宽高还是和最终宽高一致</li>
</ul>
<h1 id="2-measure过程"><a href="#2-measure过程" class="headerlink" title="2. measure过程"></a>2. measure过程</h1><p>几乎所有情况下view的测量大小和最终大小相等</p>
<h2 id="2-1-View的measure"><a href="#2-1-View的measure" class="headerlink" title="2.1. View的measure"></a>2.1. View的measure</h2><p>需重写onMeasure同时设置wrap_content时自身的大小，否则在布局中wrap_content相当于match_parent。同时考虑paddig的影响。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onMeasure</span><span class="params">(<span class="type">int</span> widthMeasureSpec, <span class="type">int</span> heightMeasureSpec)</span> &#123;</span><br><span class="line">    <span class="type">int</span> resultWidth;</span><br><span class="line">    <span class="type">int</span> <span class="variable">modeWidth</span> <span class="operator">=</span> MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">    <span class="type">int</span> <span class="variable">sizeWidth</span> <span class="operator">=</span> MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">    <span class="keyword">if</span> (modeWidth == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">        resultWidth = sizeWidth;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resultWidth = mBitmap.getWidth() + getPaddingLeft() + getPaddingRight();</span><br><span class="line">        <span class="keyword">if</span> (modeWidth == MeasureSpec.AT_MOST) &#123;</span><br><span class="line">            resultWidth = Math.min(resultWidth, sizeWidth);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> resultHeight;</span><br><span class="line">    <span class="type">int</span> <span class="variable">modeHeight</span> <span class="operator">=</span> MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">    <span class="type">int</span> <span class="variable">sizeHeight</span> <span class="operator">=</span> MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">    <span class="keyword">if</span> (modeHeight == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">        resultHeight = sizeHeight;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resultHeight = mBitmap.getHeight() + getPaddingTop() + getPaddingBottom();</span><br><span class="line">        <span class="keyword">if</span> (modeHeight == MeasureSpec.AT_MOST) &#123;</span><br><span class="line">            resultHeight = Math.min(resultHeight, sizeHeight);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    setMeasuredDimension(resultWidth, resultHeight);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-ViewGroup的measure"><a href="#2-2-ViewGroup的measure" class="headerlink" title="2.2. ViewGroup的measure"></a>2.2. ViewGroup的measure</h2><p>1 由于不同的viewgroup子类有不同的布局特性，所以交由子类实现测量细节<br>2 measureChildren();<br>3 自定义ViewGroup时，需要考虑测量以及布局子View，同时需要考虑ViewGroup的margin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onMeasure</span><span class="params">(<span class="type">int</span> widthMeasureSpec, <span class="type">int</span> heightMeasureSpec)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">    <span class="type">int</span> <span class="variable">parentDesireWidth</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">parentDesireHeight</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (getChildCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; getChildCount(); i++) &#123;</span><br><span class="line">            <span class="type">View</span> <span class="variable">childAt</span> <span class="operator">=</span> getChildAt(i);</span><br><span class="line">            <span class="type">CustomLayoutParams</span> <span class="variable">layoutParams</span> <span class="operator">=</span> (CustomLayoutParams) childAt.getLayoutParams();</span><br><span class="line">            measureChildWithMargins(childAt, widthMeasureSpec, <span class="number">0</span>, heightMeasureSpec, <span class="number">0</span>);</span><br><span class="line">            parentDesireWidth += childAt.getMeasuredWidth()</span><br><span class="line">                    + layoutParams.leftMargin</span><br><span class="line">                    + layoutParams.rightMargin;</span><br><span class="line">            parentDesireHeight += childAt.getMeasuredHeight()</span><br><span class="line">                    + layoutParams.topMargin</span><br><span class="line">                    + layoutParams.bottomMargin;</span><br><span class="line">        &#125;</span><br><span class="line">        parentDesireWidth += getPaddingLeft() + getPaddingRight();</span><br><span class="line">        parentDesireHeight += getPaddingTop() + getPaddingBottom();</span><br><span class="line">        parentDesireWidth = Math.max(parentDesireWidth, getSuggestedMinimumWidth());</span><br><span class="line">        parentDesireHeight = Math.max(parentDesireHeight, getSuggestedMinimumHeight());</span><br><span class="line">        setMeasuredDimension(resolveSize(parentDesireWidth, widthMeasureSpec),</span><br><span class="line">                resolveSize(parentDesireHeight, heightMeasureSpec));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onLayout</span><span class="params">(<span class="type">boolean</span> changed, <span class="type">int</span> l, <span class="type">int</span> t, <span class="type">int</span> r, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">parentPaddingTop</span> <span class="operator">=</span> getPaddingTop();</span><br><span class="line">    <span class="type">int</span> <span class="variable">parentPaddingLeft</span> <span class="operator">=</span> getPaddingLeft();</span><br><span class="line">    <span class="keyword">if</span> (getChildCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mutilHeight</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; getChildCount(); i++) &#123;</span><br><span class="line">            <span class="type">View</span> <span class="variable">child</span> <span class="operator">=</span> getChildAt(i);</span><br><span class="line">            <span class="type">CustomLayoutParams</span> <span class="variable">childLayoutParams</span> <span class="operator">=</span> (CustomLayoutParams) child.getLayoutParams();</span><br><span class="line">            child.layout(parentPaddingLeft + childLayoutParams.leftMargin,</span><br><span class="line">                    mutilHeight + parentPaddingTop + childLayoutParams.topMargin,</span><br><span class="line">                    child.getMeasuredWidth() + parentPaddingLeft + childLayoutParams.leftMargin,</span><br><span class="line">                    child.getMeasuredHeight() + mutilHeight + parentPaddingTop + childLayoutParams.topMargin);</span><br><span class="line">            mutilHeight += child.getMeasuredHeight()</span><br><span class="line">                    + childLayoutParams.topMargin</span><br><span class="line">                    + childLayoutParams.bottomMargin;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时需要注意的是在处理margin时，可以自己定义一个CustomLayoutParams类继承LayoutParams，此后在onMeasure和onLayout中都强制转换成CustomLayoutParams。</p>
<h2 id="2-3-view的mearsure过程和activity的生命周期不是同步执行的！"><a href="#2-3-view的mearsure过程和activity的生命周期不是同步执行的！" class="headerlink" title="2.3. view的mearsure过程和activity的生命周期不是同步执行的！"></a>2.3. view的mearsure过程和activity的生命周期不是同步执行的！</h2><p>1 onWindowFocusChanged()<br>2 view.post(Runnable)<br>3 ViewTreeObserver</p>
<h1 id="3-layout过程"><a href="#3-layout过程" class="headerlink" title="3. layout过程"></a>3. layout过程</h1><p>1 通过setFrame设定view的l、t、r、b；四点确定，则view在父容器中的位置也确定了<br>2 调用onLayout，是父容器确定子容器的位置<br>3 onLayout具体实现同样和具体布局有关，所以view和viewgroup均没有真正实现onlayout</p>
<h1 id="4-draw过程"><a href="#4-draw过程" class="headerlink" title="4. draw过程"></a>4. draw过程</h1><p>1 绘制背景 background.draw(canvas)<br>2 绘制自己 onDraw<br>3 绘制children dispatchDraw<br>4 绘制装饰 onDrawScrollBars<br>5 setWillNotDraw设置为true，系统会进行相应优化。view默认不启用，viewgroup默认启用</p>
<h1 id="5-自定义View须知"><a href="#5-自定义View须知" class="headerlink" title="5. 自定义View须知"></a>5. 自定义View须知</h1><p>1 处理好滑动冲突<br>2 处理好线程和动画，当view不可见时停止线程和动画<br>3 不要在View中使用handler，用post<br>4 让view支持padding和wrap_content</p>
<h1 id="6-自定义view实践"><a href="#6-自定义view实践" class="headerlink" title="6. 自定义view实践"></a>6. 自定义view实践</h1><p>以下是自己过去两年内写过的关于自定义控件的日志，方便以后查阅。每当Android提供的控件不能满足你的需求时，首先你应该想想是否可以在现有控件的基础上修改一下来达到你的目的，而不是盲目地直接重写View或ViewGroup类，你可以提供不同的接口方法来修改你复合控件中的各类元素。</p>
<p><a href="https://leeeyou.github.io/2016/01/22/blog-2016-01-22-Android%E4%B9%8B%E5%BC%80%E5%8F%91%E4%B8%AD%E5%BF%85%E5%A4%87%E7%9A%84%E5%9D%90%E6%A0%87%E4%BD%93%E7%B3%BB%E7%9F%A5%E8%AF%86/">Android之开发中必备的坐标体系知识</a></p>
<p><a href="https://leeeyou.github.io/2016/04/29/blog-2016-04-29-Android%E4%B9%8BPaint%E7%9A%84%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/">Android之Paint的使用总结</a><br><a href="https://leeeyou.github.io/2016/01/04/blog-2016-01-04-Android%E4%B9%8BDrawable%E3%80%81Bitmap%E3%80%81Canvas%E3%80%81Paint%E4%B9%8B%E9%97%B4%E5%8C%BA%E5%88%AB/">Android之Drawable、Bitmap、Canvas、Paint之间区别</a><br><a href="https://leeeyou.github.io/2016/01/20/blog-2016-01-20-Android%E4%B9%8B%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6%E4%B9%8B%E7%94%BB%E7%AC%94/">Android之自定义控件之画笔</a><br><a href="https://leeeyou.github.io/2016/01/11/blog-2016-01-11-Android%E4%B9%8B%E7%BB%98%E5%9B%BE%E5%9F%BA%E7%A1%80Path%E7%B1%BB/">Android之绘图基础Path类</a><br><a href="https://leeeyou.github.io/2016/01/01/blog-2016-01-01-Android%E4%B9%8B%E5%9B%BE%E5%83%8F%E7%9A%84%E8%89%B2%E5%BD%A9%E5%8F%98%E6%8D%A2/">Android之图像的色彩变换</a></p>
<p><a href="https://leeeyou.github.io/2016/02/29/blog-2016-02-29-Android%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2-%E7%AC%AC3%E7%AB%A0-View%E7%9A%84%E4%BA%8B%E4%BB%B6%E4%BD%93%E7%B3%BB/">Android艺术探索 第3章 View的事件体系</a><br><a href="https://leeeyou.github.io/2016/03/01/blog-2016-03-01-Android%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2-%E7%AC%AC4%E7%AB%A0-View%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/">Android艺术探索 第4章 View的工作原理</a><br><a href="https://leeeyou.github.io/2016/03/02/blog-2016-03-02-Android%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2-%E7%AC%AC5%E7%AB%A0-%E7%90%86%E8%A7%A3RemoteViews/">Android艺术探索 第5章 理解RemoteViews</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leeeyou.github.io/iBlogWebsite/2017/03/28/2017/2017-03-28-%20%E6%A8%A1%E6%9D%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/6735624?s=460&v=4">
      <meta itemprop="name" content="Leeeyou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leeeyou123">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iBlogWebsite/2017/03/28/2017/2017-03-28-%20%E6%A8%A1%E6%9D%BF/" class="post-title-link" itemprop="url">Markdown模板</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-03-28 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-28T00:00:00+08:00">2017-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-29 20:35:27" itemprop="dateModified" datetime="2022-11-29T20:35:27+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/iBlogWebsite/categories/project/" itemprop="url" rel="index"><span itemprop="name">project</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一级标题示例"><a href="#一级标题示例" class="headerlink" title="一级标题示例"></a>一级标题示例</h1><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2><p>这里是二级标题正文这里是二级标题正文这里是二级标题正文这里是二级标题正文这里是二级标题正文这里是二级标题正文这里是二级标题正文这里是二级标题正文这里是二级标题正文这里是二级标题正文这里是二级标题正文</p>
<p>这里是正文这里是正文这里是正文这里是正文这里是正文这里是正文这里是正文这里是正文这里是正文这里是二级标题正文这里是二级标题正文这里是二级标题正文这里是二级标题正文这里是二级标题正文这里是二级标题正文</p>
<p><img src="https://github.com/LeeeYou/Img/blob/master/leeeyou/getScrollX.png?raw=true" alt="getScrollX"></p>
<h1 id="加载代码示例"><a href="#加载代码示例" class="headerlink" title="加载代码示例"></a>加载代码示例</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.leeeyou.fixmyproblem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapShader;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="注释用法示例"><a href="#注释用法示例" class="headerlink" title="注释用法示例"></a>注释用法示例</h1><p>有两个方法可以设置控件的上下左右图标，分别是：<br><strong>第一个方法</strong>：setCompoundDrawablesWithIntrinsicBounds(Drawable left, Drawable top, Drawable right, Drawable bottom)<br><strong>第二种方法</strong>：setCompoundDrawables(Drawable left, Drawable top, Drawable right, Drawable bottom)  </p>
<p>它们的区别是使用第二种方法之前必须已经setBound(Rect)了，api原文如下</p>
<blockquote>
<p>Sets the Drawables (if any) to appear to the left of, above, to the right of, and below the text. Use null if you do not want a Drawable there. The Drawables must already have had setBounds(Rect) called.</p>
</blockquote>
<h1 id="引用网址示例"><a href="#引用网址示例" class="headerlink" title="引用网址示例"></a>引用网址示例</h1><p><strong>场景</strong>：官方比赛数据页签 - 淘汰赛和积分赛数据 → viewpager(水平) + scrollView(垂直) + HorizontalScrollView(水平) / ListView(垂直)<br><strong>分析</strong>：这里的冲突在于水平事件里面嵌套垂直，再嵌套水平和垂直事件<br><strong>解决</strong>：采用内部拦截法配合getParent().requestDisallowInterceptTouchEvent(false);  </p>
<p>这篇日志也记录了<a href="https://leeeyou.github.io/2016/02/29/blog-2016-02-29-Android%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2-%E7%AC%AC3%E7%AB%A0-View%E7%9A%84%E4%BA%8B%E4%BB%B6%E4%BD%93%E7%B3%BB/">Android艺术探索 第3章 View的事件体系</a></p>
<h1 id="表格示例"><a href="#表格示例" class="headerlink" title="表格示例"></a>表格示例</h1><table>
<thead>
<tr>
<th>Tables</th>
<th align="center">Are</th>
<th align="right">Cool</th>
</tr>
</thead>
<tbody><tr>
<td>col 3 is</td>
<td align="center">right-aligned</td>
<td align="right">$1600</td>
</tr>
<tr>
<td>col 2 is</td>
<td align="center">centered</td>
<td align="right">$12</td>
</tr>
<tr>
<td>zebra stripes</td>
<td align="center">are neat</td>
<td align="right">$1</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>dog</th>
<th>bird</th>
<th>cat</th>
</tr>
</thead>
<tbody><tr>
<td>foo</td>
<td>foo</td>
<td>foo</td>
</tr>
<tr>
<td>bar</td>
<td>bar</td>
<td>bar</td>
</tr>
<tr>
<td>baz</td>
<td>baz</td>
<td>baz</td>
</tr>
</tbody></table>
<h1 id="代办和清单"><a href="#代办和清单" class="headerlink" title="代办和清单"></a>代办和清单</h1><ul>
<li><input disabled="" type="checkbox"> 表示未完成</li>
<li><input checked="" disabled="" type="checkbox"> 表示已完成</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://leeeyou.github.io/iBlogWebsite/2017/03/28/2017/2017-03-28-2016LarkV2.0%E7%89%88App%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E9%97%AE%E9%A2%98%E6%95%B4%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/6735624?s=460&v=4">
      <meta itemprop="name" content="Leeeyou">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leeeyou123">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iBlogWebsite/2017/03/28/2017/2017-03-28-2016LarkV2.0%E7%89%88App%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E9%97%AE%E9%A2%98%E6%95%B4%E7%90%86/" class="post-title-link" itemprop="url">2016 Lark V2.0版App开发过程问题整理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-03-28 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-28T00:00:00+08:00">2017-03-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-29 20:35:27" itemprop="dateModified" datetime="2022-11-29T20:35:27+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/iBlogWebsite/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-ImageView的background和src的不同"><a href="#1-ImageView的background和src的不同" class="headerlink" title="1. ImageView的background和src的不同"></a>1. ImageView的background和src的不同</h1><p>如果两个属性同时存在,用户会看到 src 属性中设置的背景. 但同时 background 设置的背景也存在, 只是被 src 属性挡住了,在后面. src 等于是前景, background 等于是背景.background 会根据 ImageView 组件给定的长宽进行拉伸, 而 src 就存放的是原图的大小, 不会进行拉伸。src 是图片内容（前景）, bg 是背景, 可以同时使用.此外: scaleType 只对 src 起作用,比如在 ImageView 中就可以用 android:scaleType 控制图片的缩放方式 ; bg 可设置透明度.<br><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem/01_img_src.png?raw=true"><br><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem/01_img_background.png?raw=true"></p>
<h1 id="2-Glide加载圆形图和圆角图"><a href="#2-Glide加载圆形图和圆角图" class="headerlink" title="2. Glide加载圆形图和圆角图"></a>2. Glide加载圆形图和圆角图</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.leeeyou.fixmyproblem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.res.Resources;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapShader;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Paint;</span><br><span class="line"><span class="keyword">import</span> android.graphics.RectF;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.bumptech.glide.Glide;</span><br><span class="line"><span class="keyword">import</span> com.bumptech.glide.load.engine.bitmap_recycle.BitmapPool;</span><br><span class="line"><span class="keyword">import</span> com.bumptech.glide.load.resource.bitmap.BitmapTransformation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Problem02_GlideActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_glide);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">imageUrl</span> <span class="operator">=</span> <span class="string">&quot;http://7xptzi.com1.z0.glb.clouddn.com/19%E4%BA%91%E8%AF%BE%E5%A0%82_06.png&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">ImageView</span> <span class="variable">img01</span> <span class="operator">=</span> (ImageView) findViewById(R.id.img01);</span><br><span class="line">        <span class="type">ImageView</span> <span class="variable">img02</span> <span class="operator">=</span> (ImageView) findViewById(R.id.img02);</span><br><span class="line">        <span class="type">ImageView</span> <span class="variable">img03</span> <span class="operator">=</span> (ImageView) findViewById(R.id.img03);</span><br><span class="line">        <span class="comment">//Glide.with(this).load(imageUrl).thumbnail(0.1f).into(img01);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// play gif</span></span><br><span class="line">        Glide.with(<span class="built_in">this</span>).load(R.mipmap.pkq).into(img01);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// round image</span></span><br><span class="line">        Glide.with(<span class="built_in">this</span>)</span><br><span class="line">                .load(imageUrl)</span><br><span class="line">                .crossFade()</span><br><span class="line">                .transform(<span class="keyword">new</span> <span class="title class_">GlideRoundTransform</span>(<span class="built_in">this</span>))</span><br><span class="line">                .into(img02);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// circle image</span></span><br><span class="line">        Glide.with(<span class="built_in">this</span>)</span><br><span class="line">                .load(imageUrl)</span><br><span class="line">                .crossFade()</span><br><span class="line">                .transform(<span class="keyword">new</span> <span class="title class_">GlideCircleTransform</span>(<span class="built_in">this</span>))</span><br><span class="line">                .into(img03);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlideCircleTransform</span> <span class="keyword">extends</span> <span class="title class_">BitmapTransformation</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">GlideCircleTransform</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(context);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Bitmap <span class="title function_">transform</span><span class="params">(BitmapPool pool, Bitmap toTransform, <span class="type">int</span> outWidth, <span class="type">int</span> outHeight)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> circleCrop(pool, toTransform);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Bitmap <span class="title function_">circleCrop</span><span class="params">(BitmapPool pool, Bitmap source)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (source == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> Math.min(source.getWidth(), source.getHeight());</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> (source.getWidth() - size) / <span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> (source.getHeight() - size) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">squared</span> <span class="operator">=</span> Bitmap.createBitmap(source, x, y, size, size);</span><br><span class="line"></span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">result</span> <span class="operator">=</span> pool.get(size, size, Bitmap.Config.ARGB_8888);</span><br><span class="line">            <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">                result = Bitmap.createBitmap(size, size, Bitmap.Config.ARGB_8888);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Canvas</span> <span class="variable">canvas</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Canvas</span>(result);</span><br><span class="line">            <span class="type">Paint</span> <span class="variable">paint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paint</span>();</span><br><span class="line"></span><br><span class="line">            paint.setShader(<span class="keyword">new</span> <span class="title class_">BitmapShader</span>(squared, BitmapShader.TileMode.CLAMP, BitmapShader.TileMode.CLAMP));</span><br><span class="line">            paint.setAntiAlias(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">float</span> <span class="variable">radius</span> <span class="operator">=</span> size / <span class="number">2f</span>;</span><br><span class="line">            canvas.drawCircle(radius, radius, radius, paint);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getClass().getName();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlideRoundTransform</span> <span class="keyword">extends</span> <span class="title class_">BitmapTransformation</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="type">float</span> <span class="variable">radius</span> <span class="operator">=</span> <span class="number">0f</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">GlideRoundTransform</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>(context, <span class="number">4</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">GlideRoundTransform</span><span class="params">(Context context, <span class="type">int</span> dp)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(context);</span><br><span class="line">            <span class="built_in">this</span>.radius = Resources.getSystem().getDisplayMetrics().density * dp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Bitmap <span class="title function_">transform</span><span class="params">(BitmapPool pool, Bitmap toTransform, <span class="type">int</span> outWidth, <span class="type">int</span> outHeight)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> roundCrop(pool, toTransform);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Bitmap <span class="title function_">roundCrop</span><span class="params">(BitmapPool pool, Bitmap source)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (source == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">Bitmap</span> <span class="variable">result</span> <span class="operator">=</span> pool.get(source.getWidth(), source.getHeight(), Bitmap.Config.ARGB_8888);</span><br><span class="line">            <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">                result = Bitmap.createBitmap(source.getWidth(), source.getHeight(), Bitmap.Config.ARGB_8888);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Canvas</span> <span class="variable">canvas</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Canvas</span>(result);</span><br><span class="line">            <span class="type">Paint</span> <span class="variable">paint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paint</span>();</span><br><span class="line">            paint.setShader(<span class="keyword">new</span> <span class="title class_">BitmapShader</span>(source, BitmapShader.TileMode.CLAMP, BitmapShader.TileMode.CLAMP));</span><br><span class="line">            paint.setAntiAlias(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">RectF</span> <span class="variable">rectF</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RectF</span>(<span class="number">0f</span>, <span class="number">0f</span>, source.getWidth(), source.getHeight());</span><br><span class="line">            canvas.drawRoundRect(rectF, radius, radius, paint);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getClass().getName();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="3-setCompoundDrawablesWithIntrinsicBounds的优势"><a href="#3-setCompoundDrawablesWithIntrinsicBounds的优势" class="headerlink" title="3. setCompoundDrawablesWithIntrinsicBounds的优势"></a>3. setCompoundDrawablesWithIntrinsicBounds的优势</h1><p>有两个方法可以设置控件的上下左右图标，分别是：<br><strong>第一个方法</strong>：setCompoundDrawablesWithIntrinsicBounds(Drawable left, Drawable top, Drawable right, Drawable bottom)<br><strong>第二种方法</strong>：setCompoundDrawables(Drawable left, Drawable top, Drawable right, Drawable bottom)  </p>
<p>它们的区别是使用第二种方法之前必须已经setBound(Rect)了，api原文如下</p>
<blockquote>
<p>Sets the Drawables (if any) to appear to the left of, above, to the right of, and below the text. Use null if you do not want a Drawable there. The Drawables must already have had setBounds(Rect) called.</p>
</blockquote>
<p>所以：<br>如果想手动设置大小的话就要用setCompoundDrawables，事先要给Drawable设置setBounds；<br>如果按照原有比例大小显示图片就使用setCompoundDrawablesWithIntrinsicBounds  </p>
<h1 id="4-滑动事件冲突的处理"><a href="#4-滑动事件冲突的处理" class="headerlink" title="4. 滑动事件冲突的处理"></a>4. 滑动事件冲突的处理</h1><p><strong>场景</strong>：官方比赛数据页签 - 淘汰赛和积分赛数据 → viewpager(水平) + scrollView(垂直) + HorizontalScrollView(水平) / ListView(垂直)<br><strong>分析</strong>：这里的冲突在于水平事件里面嵌套垂直，再嵌套水平和垂直事件<br><strong>解决</strong>：采用内部拦截法配合getParent().requestDisallowInterceptTouchEvent(false);  </p>
<p>效果图如下：<br><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem/04_event.png?raw=true"></p>
<p>这篇日志也记录了<a href="https://leeeyou.github.io/2016/02/29/blog-2016-02-29-Android%E8%89%BA%E6%9C%AF%E6%8E%A2%E7%B4%A2-%E7%AC%AC3%E7%AB%A0-View%E7%9A%84%E4%BA%8B%E4%BB%B6%E4%BD%93%E7%B3%BB/">Android艺术探索 第3章 View的事件体系</a></p>
<h1 id="5-shape资源整理"><a href="#5-shape资源整理" class="headerlink" title="5. shape资源整理"></a>5. shape资源整理</h1><p><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem/05_shape.png?raw=true"></p>
<p><strong>android:shape=[“rectangle” | “oval” | “line” | “ring”]</strong><br>shape的形状，默认为矩形，可以设置为矩形（rectangle）、椭圆形(oval)、线性形状(line)、环形(ring)下面的属性只有在android:shape=”ring时可用：<br>android:innerRadius    尺寸，内环的半径。<br>android:innerRadiusRatio    浮点型，以环的宽度比率来表示内环的半径，例如，如果android:innerRadiusRatio，表示内环半径等于环的宽度除以5，这个值是可以被覆盖的，默认为9.<br>android:thickness    尺寸，环的厚度<br>android:thicknessRatio    浮点型，以环的宽度比率来表示环的厚度，例如，如果android:thicknessRatio=”2”， 那么环的厚度就等于环的宽度除以2。这个值是可以被android:thickness覆盖的，默认值是3.<br>android:useLevel    boolean值，如果当做是LevelListDrawable使用时值为true，否则为false.  </p>
<p><strong>corners</strong><br>android:radius                                 整型半径<br>android:topLeftRadius                    整型左上角半径<br>android:topRightRadius                  整型右上角半径<br>android:bottomLeftRadius              整型左下角半径<br>android:bottomRightRadius            整型右下角半径  </p>
<p><strong>渐变色</strong><br>android:startColor         颜色值 起始颜色<br>android:endColor          颜色值结束颜色<br>android:centerColor      整型渐变中间颜色，即开始颜色与结束颜色之间的颜色<br>android:angle                整型渐变角度(PS:当angle=0时，渐变色是从左向右。 然后逆时针方向转，当angle=90时为从下往上。angle必须为45的整数倍)<br>android:type             [“linear” | “radial” | “sweep”] 渐变类型(取值：linear、radial、sweep)<br>                         linear 线性渐变，这是默认设置<br>                         radial 放射性渐变，以开始色为中心。<br>                         sweep 扫描线式的渐变。<br>android:useLevel             [“true” | “false”]如果要使用LevelListDrawable对象，就要设置为true。设置为true无渐变。false有渐变色<br>android:gradientRadius   整型渐变色半径.当 android:type=”radial” 时才使用。单独使用 android:type=”radial”会报错。<br>android:centerX               整型渐变中心X点坐标的相对位置<br>android:centerY               整型渐变中心Y点坐标的相对位置  </p>
<p><strong>描边</strong><br>android:width                   整型描边的宽度<br>android:color                    颜色值描边的颜色<br>android:dashWidth           整型表示描边的样式是虚线的宽度， 值为0时，表示为实线。值大于0则为虚线。<br>android:dashGap              整型表示描边为虚线时，虚线之间的间隔 即“ - - - - ”  </p>
<h1 id="6-记录bug-Manifest-merger-failed-error"><a href="#6-记录bug-Manifest-merger-failed-error" class="headerlink" title="6. 记录bug:Manifest merger failed error"></a>6. 记录bug:Manifest merger failed error</h1><p>由于build.gradle文件中的defaultConfig中的信息和其他module中的不同。检查minSdkVersion、targetSdkVersion是否和其他module一致</p>
<h1 id="7-整理ripple"><a href="#7-整理ripple" class="headerlink" title="7. 整理ripple"></a>7. 整理ripple</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ripple</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:color</span>=<span class="string">&quot;@color/txt_ed4d4d&quot;</span>&gt;</span><span class="comment">&lt;!-- 波纹颜色 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义一个带圆角的背景 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">shape</span> <span class="attr">android:shape</span>=<span class="string">&quot;rectangle&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 正常状态下的颜色 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;@color/txt_blue&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">stroke</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:width</span>=<span class="string">&quot;2dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:color</span>=<span class="string">&quot;@color/txt_ed4d4d&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">corners</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:bottomLeftRadius</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:bottomRightRadius</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:topLeftRadius</span>=<span class="string">&quot;8dp&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:topRightRadius</span>=<span class="string">&quot;8dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ripple</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="8-整理fragment-universalAdapter-notify不成功的原因"><a href="#8-整理fragment-universalAdapter-notify不成功的原因" class="headerlink" title="8. 整理fragment universalAdapter notify不成功的原因"></a>8. 整理fragment universalAdapter notify不成功的原因</h1><p>nofityDataSetChange不成功的原因：<br>1、数据源没有更新，调用notifyDataSetChanged无效。<br>2、数据源更新了，但是它指向新的引用，调用notifyDataSetChanged无效。<br>3、数据源更新了，但是adpter没有收到消息通知，无法动态更新列表。  </p>
<p>由于在Fragment中调用notifyDataSetChange老是不成功，所以决定好好的研究研究为何UniversalAdapter会引起此问题。</p>
<p>其实好好的理解上面三条之后，解决ListView刷新不显示的问题，肯定妥妥的。</p>
<p><strong>总结起来就是：数据源的引用一定不能变，但是塞到数据源中的数据一定要更新。牢牢地掌握好这一条之后，ListView刷新不显示的问题就迎刃而解了。</strong></p>
<p><strong>解决“数据源的引用一定不能变”的问题</strong>，可以提前创建一个List对象， mData = new ArrayList&lt;&gt;(); 之后一直对这个mData倒腾即可，不要再引入新的数据源，也就是不要再改变mData的引用地址。</p>
<p><strong>解决“但是塞到数据源中的数据一定要更新”的问题</strong>，可以通过更新数据完成，万一数据源就是没有更新，又想要塞到数据源中，可以通过<br>mData.clear();<br>mData.addAll(data);<br>方法实现。</p>
<p>这次bug的产生就是由于没有事先创建一个mData的对象，直接将入参赋值给mData，导致执行<br>mData.clear();<br>mData.addAll(data);<br>时，先清空了数据集，然后将空数据集添加到了mData中，此时再去调用notifyDataSetChanged()时，其实生效了，但是数据为0，当然就展示了空白页。</p>
<p>同时需要再次调用setAdapter()方法。</p>
<p>通过这次的bug解决，自己认识到遇到问题时，最好追根究底的去解决它。因为你一定会不止一次遇到这个问题。当你彻底理解和掌握了之后，下次再遇到同样的问题时，显然就不是问题了。</p>
<p>解决方法截图：</p>
<p><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem/08_adapter_1.png?raw=true"><br><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem/08_adapter_2.png?raw=true"></p>
<h1 id="9-记录bug：recyclerView在fragment中-notifyDataSetChange不起作用的问题"><a href="#9-记录bug：recyclerView在fragment中-notifyDataSetChange不起作用的问题" class="headerlink" title="9. 记录bug：recyclerView在fragment中 notifyDataSetChange不起作用的问题"></a>9. 记录bug：recyclerView在fragment中 notifyDataSetChange不起作用的问题</h1><p><strong>现象</strong>：在创建一口价时，activity中放置了两个fragment，选择图片时，跳转到另外一个界面，返回时，又重新创建了fragment<br><strong>分析</strong>：由于采用ViewPager放置两个fragment，在每次切换的是否都创建了新的fragment，导致每次选好照片之后回到viewpager时，又重新创建了新的fragment，所以notifyDataSetChange无效。<br><strong>解决</strong>：两个fragment用全局变量记录保存，不要每次创建新的。<br><strong>后续</strong>：在adapter.getlist.size 返回0时，就应该联想到是否fragment被重新创建了。以此记录  </p>
<h1 id="10-EventBus粘性事件"><a href="#10-EventBus粘性事件" class="headerlink" title="10. EventBus粘性事件"></a>10. EventBus粘性事件</h1><p>EventBus默认支持一条事件总线，通常是通过getDefault()方法获取EventBus实例，但也能通过直接new EventBus这种最简单的方式获取多条事件总线，彼此之间完全分开。例子见com.example.leeeyou.fixmyproblem.Problem05_EventBusActivity</p>
<p>EventBus#Register()其实只做了三件事：  </p>
<ol>
<li>查找订阅者所有的订阅事件  </li>
<li>将订阅事件作为key，所有订阅了此订阅事件的订阅者作为value存放进subscriptionsByEventType  </li>
<li>将订阅者作为key，订阅者的所有订阅事件作为value存放进typesBySubscriber  </li>
</ol>
<p>EventBus#Post()也只做了三件事:  </p>
<ol>
<li>根据订阅事件在subscriptionsByEventType中查找相应的订阅者  </li>
<li>分发订阅者的订阅事件调用线程  </li>
<li>通过反射调用订阅者的订阅事件  </li>
</ol>
<p>粘性事件：发送事件之后再订阅该事件也能收到该事件，跟粘性广播类似。简单来说就是能够收到订阅之前发送的消息。</p>
<h1 id="11-事件传递机制"><a href="#11-事件传递机制" class="headerlink" title="11. 事件传递机制"></a>11. 事件传递机制</h1><p>① 假设最高层View叫OuterLayout，中间层View叫InnerLayout，最底层View叫MyVIew。调用顺序是这样的（假设各个函数返回的都是false）<br>OuterLayout.onInterceptTouchEvent-&gt;InnerLayout.onInterceptTouchEvent-&gt;MyView.onTouchEvent-&gt;InnerLayout.onTouchEvent-&gt;OuterLayout.onTouchEvent。<br><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem/11_event_dispatch.png?raw=true"></p>
<p>② 内部拦截法，子控件拦截父控件事件<br><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem/11_event_dispatch_2.png?raw=true"></p>
<p>③ 注意点<br>一个view一旦拦截一个某个事件，当前事件所在的完整事件序列将都会由这个view去处理，反应在真实的代码中，就是一旦view拦截了down事件，那么此后的move和up事件都将不调用onInterceptTouchEvent，而直接由它处理，这就也意味着在onInterceptTouchEvent处理事件是不合适的，因为有可能来了事件，却直接跳过onInterceptTouchEvent方法。这个也意味着，一旦一个ViewGroup没有拦截ACTION_DOWN，那么这个事件序列的其他Action，它都将收不到，所以在处理ACTION_DOWN的时候，尤其需要谨慎。</p>
<p>④ 注意点<br>onTouchEvent中是要判断MotionEvent的Action，因为一次点击操作就会调用两次onTouchEvent方法，一次是ACTION_DOWN，一次是ACTION_UP，如果手滑一下，还会有若干个ACTION_MOVE</p>
<p>⑤问题：TextView的onTouchEvent的返回值也是True吗？<br>是的，那为什么点在TextView上面还是能触发它的父视图的onTouchEvent，理论上应该是TextView消耗掉这次的事件，不回传。理论上确实是这样，但是因为TextView的clickable和longClickable属性都是false，当这两个属性都为false的时候，是不会消耗事件的，所以TextView不会消耗事件，这也就可以解释为什么把一个TextView放在一个Button上面，然后点击TextView还是能触发Button的点击事件</p>
<p>⑥问题：view的enable状态和onTouchEvent之间的关系<br>它们之间没有关系，只有clickable状态才对onTouchEvent有影响的，还有一点 ，设置 view的enable为false确实也会把view的clickable设成false，但是设置view的onclickListener就又把view的clickable变成了true，所以最后的解决方案就是把那两行代码换下先后顺序，问题就迎刃而解了。</p>
<p>⑦问题：onTouchListener OnTouchEvent OnClickListener<br>onTouchListener是在onTouch方法中生效，而且onTouch要先于onTouchEvent，就是说一旦设置了onTouchListener并且最后onTouch方法返回了True，那onTouchEvent将不会再被执行。而onClickListener和onTouchEvent有些关系，onTouchEvent的默认实现里会调用onClickListener的onClick方法，如果重写了onTouchEvent，因为onClickListener接受不到ACTION_DOWN和ACTION_UP，那么再设置onClickListener也就不会再生效了，这个时候的单击或者长按处理只能在onTouchEvent中自己处理。</p>
<h1 id="12-patch"><a href="#12-patch" class="headerlink" title="12. patch"></a>12. patch</h1><p>为什么叫9patch呢？Patch的中文意思是”片，块”的意思，那这里按中文的意思来说就是9片或9块.因此可想而知这个图片会被分为9片，如下图片所示:<br><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem/12_9patch_1.png?raw=true"><br>工具栏中的Show patches选中，中间紫色的区域就是拉伸区域。<br>工具栏中的Show content选中，看见蓝色的区域，这片区域就是显示内容的区域；比如说：这个图片宽有30px,我们把下面的那一条线的横向的第20px到25px画上了黑点，那么这个图片设置成某个组件的背景后，这个组件的paddingleft就会设置成20dp,paddingRight就会设置成5dp,如果再在布局文件里面设置这两个值，那个这里画的黑点就不起作用了。</p>
<p>工具栏中的Show bad patches选中，可能会出现下图效果：<br><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem/12_9patch_2.png?raw=true"><br>其中被选中的3块不符合要求。这里它是根据什么来判断这个绘制的结果不符合要求呢？怎么就认为这三块不符合要求呢？它是根据左侧的黑色的小点所对过来的部分里面的每一个像素点的颜色是否一样。如果像素存在差异，当背景变大的时候就有两种颜色要被重复的绘制，系统就不知道到底绘制这两种颜色哪一种多一点，因此这个工具建议被拉伸的区域只能选择一种颜色。  </p>
<p>如果对结果要求比较高的,右下角坐标显示区域就起作用了。</p>
<h1 id="13-Fragment的使用总结"><a href="#13-Fragment的使用总结" class="headerlink" title="13. Fragment的使用总结"></a>13. Fragment的使用总结</h1><p>1、replace和add方式的区别</p>
<p>replace 是先remove掉相同containerViewId的所有fragment，然后在add当前的这个fragment。  </p>
<blockquote>
<p>Replace an existing fragment that was added to a container. This is essentially the same as calling remove(Fragment) for all currently added fragments that were added with the same containerViewId and then add(int, Fragment, String) with the same arguments given here.</p>
</blockquote>
<p>add 是把一个fragment添加到一个容器 container 里。  </p>
<blockquote>
<p>Add a fragment to the activity state. This fragment may optionally also have its view (if Fragment.onCreateView returns non-null) into a container view of the activity.</p>
</blockquote>
<p>而至于返回键，这个跟事务有关，跟使用add还是replace没有任何关系。</p>
<p>2、采用replace时的生命周期流转</p>
<p>加载fragment<br>09-09 17:17:40.906 E: LifeCycle01Fragment onAttach<br>09-09 17:17:40.906 E: LifeCycle01Fragment onCreate<br>09-09 17:17:40.911 E: LifeCycle01Fragment onCreateView<br>09-09 17:17:40.912 E: LifeCycle01Fragment onViewCreated<br>09-09 17:17:40.912 E: LifeCycle01Fragment onActivityCreated<br>09-09 17:17:40.912 E: LifeCycle01Fragment onStart<br>09-09 17:17:40.912 E: LifeCycle01Fragment onResume  </p>
<p>屏幕灭掉<br>09-09 16:37:30.910 E: LifeCycle01Fragment onPause<br>09-09 16:37:30.953 E: LifeCycle01Fragment onSaveInstanceState<br>09-09 16:37:30.953 E: LifeCycle01Fragment onStop  </p>
<p>点亮屏幕<br>09-09 16:38:05.967 E: LifeCycle01Fragment onStart<br>09-09 16:38:05.976 E: LifeCycle01Fragment onResume  </p>
<p>切换到其他的fragment<br>09-09 16:38:30.691 E: LifeCycle01Fragment onPause<br>09-09 16:38:30.691 E: LifeCycle01Fragment onStop<br>09-09 16:38:30.691 E: LifeCycle01Fragment onDestroyView<br>09-09 16:38:30.691 E: LifeCycle01Fragment onDestroy<br>09-09 16:38:30.691 E: LifeCycle01Fragment onDetach  </p>
<p>切换回本身（相当于重新加载fragment）<br>09-09 17:19:19.368 E: LifeCycle01Fragment onAttach<br>09-09 17:19:19.368 E: LifeCycle01Fragment onCreate<br>09-09 17:19:19.371 E: LifeCycle01Fragment onCreateView<br>09-09 17:19:19.372 E: LifeCycle01Fragment onViewCreated<br>09-09 17:19:19.372 E: LifeCycle01Fragment onActivityCreated<br>09-09 17:19:19.372 E: LifeCycle01Fragment onStart<br>09-09 17:19:19.372 E: LifeCycle01Fragment onResume  </p>
<p>回到桌面<br>09-09 16:39:49.689 E: LifeCycle01Fragment onPause<br>09-09 16:39:49.803 E: LifeCycle01Fragment onSaveInstanceState<br>09-09 16:39:49.803 E: LifeCycle01Fragment onStop  </p>
<p>回到应用<br>09-09 16:40:10.743 E: LifeCycle01Fragment onStart<br>09-09 16:40:10.743 E: LifeCycle01Fragment onResume  </p>
<p>退出应用<br>09-09 16:44:06.357 E: LifeCycle01Fragment onPause<br>09-09 16:44:06.662 E: LifeCycle01Fragment onStop<br>09-09 16:44:06.663 E: LifeCycle01Fragment onDestroyView<br>09-09 16:44:06.663 E: LifeCycle01Fragment onDestroy<br>09-09 16:44:06.663 E: LifeCycle01Fragment onDetach  </p>
<p>采用replace方式的生命周期相对比较简单，因为replace的机制是remove掉相同containerViewId的fragment，再重新加载一把fragment。</p>
<p>3、采用add - show - hide方式的生命周期流转</p>
<p>加载fragment<br>09-09 17:14:04.440 E: LifeCycle01Fragment onAttach<br>09-09 17:14:04.440 E: LifeCycle01Fragment onCreate<br>09-09 17:14:04.445 E: LifeCycle01Fragment onCreateView<br>09-09 17:14:04.446 E: LifeCycle01Fragment onViewCreated<br>09-09 17:14:04.446 E: LifeCycle01Fragment onActivityCreated<br>09-09 17:14:04.446 E: LifeCycle01Fragment onStart<br>09-09 17:14:04.446 E: LifeCycle01Fragment onResume  </p>
<p>屏幕灭掉<br>09-09 16:37:30.910 E: LifeCycle01Fragment onPause<br>09-09 16:37:30.953 E: LifeCycle01Fragment onSaveInstanceState<br>09-09 16:37:30.953 E: LifeCycle01Fragment onStop  </p>
<p>点亮屏幕<br>09-09 16:38:05.967 E: LifeCycle01Fragment onStart<br>09-09 16:38:05.976 E: LifeCycle01Fragment onResume  </p>
<p>切换到其他的fragment<br>没有执行到生命周期方法  </p>
<p>切回本身（addToBackStack的情况下）<br>09-09 17:14:53.309 E: LifeCycle01Fragment onPause<br>09-09 17:14:53.309 E: LifeCycle01Fragment onStop<br>09-09 17:14:53.309 E: LifeCycle01Fragment onDestroyView<br>09-09 17:14:53.310 E: LifeCycle01Fragment onDestroy<br>09-09 17:14:53.310 E: LifeCycle01Fragment onDetach  </p>
<p>回到桌面<br>09-09 17:15:50.753 E: LifeCycle01Fragment onPause<br>09-09 17:15:50.855 E: LifeCycle01Fragment onSaveInstanceState<br>09-09 17:15:50.855 E: LifeCycle01Fragment onStop  </p>
<p>回到应用<br>09-09 17:16:12.903 E: LifeCycle01Fragment onStart<br>09-09 17:16:12.903 E: LifeCycle01Fragment onResume  </p>
<p>退出应用<br>09-09 17:16:30.815 E: LifeCycle01Fragment onPause<br>09-09 17:16:30.815 E: LifeCycle01Fragment onStop<br>09-09 17:16:30.815 E: LifeCycle01Fragment onDestroyView<br>09-09 17:16:30.816 E: LifeCycle01Fragment onDestroy<br>09-09 17:16:30.816 E: LifeCycle01Fragment onDetach  </p>
<p>这种方式有个值得注意的地方是切换到其他framgent时，并没有执行生命周期。❓</p>
<p>与Activity生命周期的对比<br><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem//13_fragment_lifecycle.png?raw=true"></p>
<p>对于replace和add方式的选择，官方文档解释说：replace()这个方法只是在上一个Fragment不再需要时采用的简便方法。正确的切换方式是add()，切换时hide()，add()另一个Fragment；再次切换时，只需hide()当前，show()另一个。这样就能做到多个Fragment切换不重新实例化。</p>
<p>fragment的生命周期与activity的生命周期的一个关键区别就在于：fragment的生命周期方法是由托管acitivity而不是操作系统调用的。操作系统无从知晓activity用来管理视图的fragment。fragment的使用是activity自己内部的使用。</p>
<p>4、addToBackStack<br>对于是否要加transaction.addToBackStack(null);也就是将Fragment加入到回退栈。官方的说法是取决于你是否要在回退的时候显示上一个Fragment。</p>
<h1 id="14-Math中对于小数的处理"><a href="#14-Math中对于小数的处理" class="headerlink" title="14. Math中对于小数的处理"></a>14. Math中对于小数的处理</h1><p>09-11 10:18:14.193 I: Math.ceil(109.82934) = 110.0<br>09-11 10:18:14.193 I: Math.floor(109.82934) = 109.0<br>09-11 10:18:14.193 I: Math.round(109.82934) = 110<br>09-11 10:18:14.194 I: DecimalFormat 0.00 会四舍五入小数部分, 109.82964 约等于 109.83<br>09-11 10:18:14.194 I: DecimalFormat #.00 会四舍五入小数部分, 109.82964 约等于 109.83<br>09-11 10:18:14.195 I: String format %.2f 会四舍五入小数部分, 109.82964 约等于 109.83<br>09-11 10:18:14.196 I: BigDecimal  3位小数 BigDecimal.ROUND_HALF_UP 会四舍五入小数部分, 109.82964 约等于 109.830<br>09-11 10:18:14.196 I: BigDecimal  3位小数 BigDecimal.ROUND_DOWN 直接舍弃小数部分, 109.82964 约等于 109.829<br>09-11 10:18:14.209 I: float型转json  : {“name”:”Jack”,”score”:0.01}  </p>
<h1 id="15-开发经验整理"><a href="#15-开发经验整理" class="headerlink" title="15. 开发经验整理"></a>15. 开发经验整理</h1><p>① 对于图片的处理，务必考虑使用缩略图<br>② 类似订单状态和货架状态的需求，在有很多个状态的情况下，在开发之前最好整理各个状态对应的操作和文案；同时尽量做成一个Activity，避免跳转的时候跳转多界面的处理，同时对外的入参最好也只依赖一个orderId或者goodsId之类的，不要传递完整的对象，因为有可能其他模块提供不了完整对象。<br>③ 订单的多个状态下，写了多个activity去匹配，这样的缺点是当有消息推送时，不能根据一个orderId准确的知道需要跳转到哪个界面去。  </p>
<h1 id="16-ExpandableListView"><a href="#16-ExpandableListView" class="headerlink" title="16. ExpandableListView"></a>16. ExpandableListView</h1><p>① 更改箭头的位置<br>调用setGroupIndicator(null);可以隐藏指示器  </p>
<p>可以在getGroupView中根据isExpanded来动态显示上箭头和下箭头</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> View <span class="title function_">getGroupView</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> groupPosition, <span class="type">boolean</span> isExpanded, View convertView, ViewGroup parent)</span> &#123;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isExpanded) &#123;</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> BitmapFactory.decodeResource(context.getResources(), R.mipmap.icon_arrow_down_grey);</span><br><span class="line">        <span class="type">BitmapDrawable</span> <span class="variable">bitmapDrawable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BitmapDrawable</span>(context.getResources(), bitmap);</span><br><span class="line">        groupViewHolder.tv_game_schedule_num.setCompoundDrawablesWithIntrinsicBounds(<span class="literal">null</span>, <span class="literal">null</span>, bitmapDrawable, <span class="literal">null</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> BitmapFactory.decodeResource(context.getResources(), R.mipmap.icon_arrow_up_grey);</span><br><span class="line">        <span class="type">BitmapDrawable</span> <span class="variable">bitmapDrawable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BitmapDrawable</span>(context.getResources(), bitmap);</span><br><span class="line">        groupViewHolder.tv_game_schedule_num.setCompoundDrawablesWithIntrinsicBounds(<span class="literal">null</span>, <span class="literal">null</span>, bitmapDrawable, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> convertView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>② BaseExpandableListAdapter点击时，影响其他item的问题<br><strong>问题</strong>：造成此问题的原因是setGroupViewListener方法中先去获取了ExpandableListView当前的收起/展开状态，然后根据此状态再去调用collapseGroup或expandGroup，最后立即通过ExpandableListView.isGroupExpanded获取此时的收起/展开状态，此时的状态是不准确的。  </p>
<p><strong>解决方案</strong>：在调用collapseGroup或expandGroup方法之后，监听onGroupExpanded和onGroupCollapsed方法，在其中调用notifyDataSetChanged();去刷新界面，然后在getGroupView中根据isExpanded去动态改变UI的上箭头还是下箭头。  </p>
<p>③ BaseExpandableListAdapter notifyDataSetChange()的问题<br><strong>问题</strong>：调用notifyDataSetChange()无效  </p>
<p><strong>分析</strong>：开始以为是notifyDataSetChange没有刷新造成的，后台debug跟进到Adapter的getGroupView时，发现调用了getGroupView方法，也就是系统API执行了刷新操作，只是getGroupView中自己的逻辑处理有问题。当前如果是没有数据的情况，getGroupView展示的是item_no_data_layout布局，但是如果有数据进来，调用notifyDataSetChange时，会执行到getGroupView，此时会复用item_no_data_layout布局，但是此布局并不是我们的数据展示布局，所以要再加一层判断，如viewHolder==null，需要再加载一次item_offical_game布局到convertView  </p>
<p><strong>解决方案</strong>：双层判断viewHolder==null，如果为null，需要再加载一次item_offical_game布局到convertView  </p>
<p><img src="https://github.com/LeeeYou/Img/blob/master/fixmyproblem/16_expandlistview.png?raw=true"></p>
<h1 id="17-JSONArray-，JSONObject-json相互转换"><a href="#17-JSONArray-，JSONObject-json相互转换" class="headerlink" title="17. JSONArray ，JSONObject , json相互转换"></a>17. JSONArray ，JSONObject , json相互转换</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jsonobject , jsonarray , json 互转</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Problem10_JSONArray_Activity</span> <span class="keyword">extends</span> <span class="title class_">BaseActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_jsonarray);</span><br><span class="line"></span><br><span class="line">        jsonStringTojsonObj();</span><br><span class="line">        jsonArrayTojsonObj();</span><br><span class="line">        jsonObjTojsonObj();</span><br><span class="line">        listobjTojsonArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">listobjTojsonArray</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; imageList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        imageList.add(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/51c1e24b6b821c916f732c2aa5b1dc9f.jpg&quot;</span>);</span><br><span class="line">        imageList.add(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/8ad331112d30453d2ace4c31903c5c55.jpg&quot;</span>);</span><br><span class="line">        imageList.add(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/839f7a8407047bab2d7a721c114912df.jpg&quot;</span>);</span><br><span class="line">        imageList.add(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/369ca74245ebc32d512eae501e7de807.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>(<span class="keyword">new</span> <span class="title class_">Gson</span>().toJson(imageList));</span><br><span class="line"></span><br><span class="line">            Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;listobjTojsonArray Gson ---- &quot;</span> + jsonArray.toString());</span><br><span class="line"></span><br><span class="line">            <span class="type">JSONArray</span> <span class="variable">jsonArray2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>(imageList);</span><br><span class="line">            Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;listobjTojsonArray 直接转换 ---- &quot;</span> + jsonArray2.toString());</span><br><span class="line"></span><br><span class="line">            Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;-------------------- &quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">jsonObjTojsonObj</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        jsonArray.put(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/51c1e24b6b821c916f732c2aa5b1dc9f.jpg&quot;</span>);</span><br><span class="line">        jsonArray.put(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/8ad331112d30453d2ace4c31903c5c55.jpg&quot;</span>);</span><br><span class="line">        jsonArray.put(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/839f7a8407047bab2d7a721c114912df.jpg&quot;</span>);</span><br><span class="line">        jsonArray.put(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/369ca74245ebc32d512eae501e7de807.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jsonObject.put(<span class="string">&quot;imageList&quot;</span>, jsonArray);</span><br><span class="line">            jsonObject.put(<span class="string">&quot;age&quot;</span>, <span class="number">28</span>);</span><br><span class="line">            jsonObject.put(<span class="string">&quot;nickName&quot;</span>, <span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//直接调用toString可以将JSONObject转换成json字符串</span></span><br><span class="line">        Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;jsonObjTojsonObj ---- &quot;</span> + jsonObject.toString());</span><br><span class="line"></span><br><span class="line">        Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;jsonObjTojsonObj Gson ---- &quot;</span> + <span class="keyword">new</span> <span class="title class_">Gson</span>().toJson(jsonObject));</span><br><span class="line"></span><br><span class="line">        Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;-------------------- &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">jsonArrayTojsonObj</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        jsonArray.put(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/51c1e24b6b821c916f732c2aa5b1dc9f.jpg&quot;</span>);</span><br><span class="line">        jsonArray.put(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/8ad331112d30453d2ace4c31903c5c55.jpg&quot;</span>);</span><br><span class="line">        jsonArray.put(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/839f7a8407047bab2d7a721c114912df.jpg&quot;</span>);</span><br><span class="line">        jsonArray.put(<span class="string">&quot;http://quncao-app.b0.upaiyun.com/369ca74245ebc32d512eae501e7de807.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//直接调用toString可以将JSONArray转换成json字符串</span></span><br><span class="line">        Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;jsonArrayTojsonObj ---- &quot;</span> + jsonArray.toString());</span><br><span class="line"></span><br><span class="line">        Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;-------------------- &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">jsonStringTojsonObj</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">imageObject</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;imageList\&quot;:[&#123;\&quot;id\&quot;: 292,\&quot;imageUrl\&quot;: \&quot;http://quncao-app.b0.upaiyun.com/51c1e24b6b821c916f732c2aa5b1dc9f.jpg\&quot;&#125;,&#123;\&quot;id\&quot;: 289,\&quot;imageUrl\&quot;: \&quot;http://quncao-app.b0.upaiyun.com/8ad331112d30453d2ace4c31903c5c55.jpg\&quot;&#125;,&#123;\&quot;id\&quot;: 288,\&quot;imageUrl\&quot;: \&quot;http://quncao-app.b0.upaiyun.com/839f7a8407047bab2d7a721c114912df.jpg\&quot;&#125;,&#123;\&quot;id\&quot;: 291,\&quot;imageUrl\&quot;: \&quot;http://quncao-app.b0.upaiyun.com/369ca74245ebc32d512eae501e7de807.jpg\&quot;&#125;]&#125;&quot;</span>;</span><br><span class="line">        <span class="type">FixedPrice</span> <span class="variable">fixedPrice</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(imageObject, FixedPrice.class);</span><br><span class="line">        Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;jsonStringTojsonObj ---- &quot;</span> + fixedPrice.toString());</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">imageArray</span> <span class="operator">=</span> <span class="string">&quot;[&#123;\&quot;id\&quot;: 292,\&quot;imageUrl\&quot;: \&quot;http://quncao-app.b0.upaiyun.com/51c1e24b6b821c916f732c2aa5b1dc9f.jpg\&quot;&#125;,&#123;\&quot;id\&quot;: 289,\&quot;imageUrl\&quot;: \&quot;http://quncao-app.b0.upaiyun.com/8ad331112d30453d2ace4c31903c5c55.jpg\&quot;&#125;,&#123;\&quot;id\&quot;: 288,\&quot;imageUrl\&quot;: \&quot;http://quncao-app.b0.upaiyun.com/839f7a8407047bab2d7a721c114912df.jpg\&quot;&#125;,&#123;\&quot;id\&quot;: 291,\&quot;imageUrl\&quot;: \&quot;http://quncao-app.b0.upaiyun.com/369ca74245ebc32d512eae501e7de807.jpg\&quot;&#125;]&quot;</span>;</span><br><span class="line">        List&lt;Image&gt; imageList = <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(imageArray, <span class="keyword">new</span> <span class="title class_">TypeToken</span>&lt;List&lt;Image&gt;&gt;() &#123;</span><br><span class="line">        &#125;.getType());</span><br><span class="line"></span><br><span class="line">        Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;jsonStringTojsonObj gson fromJson ---- &quot;</span> + fixedPrice.toString());</span><br><span class="line">        Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;jsonStringTojsonObj TypeToken ---- &quot;</span> + imageList.toString());</span><br><span class="line"></span><br><span class="line">        Log.e(<span class="string">&quot;com.jsonarray&quot;</span>, <span class="string">&quot;-------------------- &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> id;</span><br><span class="line">        <span class="keyword">public</span> String imageUrl;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Gson</span>().toJson(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">FixedPrice</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> List&lt;Image&gt; imageList;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Gson</span>().toJson(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="18-记录bug-Fragment-already-active"><a href="#18-记录bug-Fragment-already-active" class="headerlink" title="18. 记录bug:Fragment already active"></a>18. 记录bug:Fragment already active</h1><p><strong>现象</strong>：<br>反复进入退出进入退出某一个fragment界面导致<br><strong>分析</strong>：<br>在 Fragment 没有被添加到 FragmentManager 之前，我们可以通过 Fragment.setArguments() 来设置参数，并在 Fragment 中，使用 getArguments() 来取得参数。在 Fragment 被添加到 FragmentManager 后，一旦被使用，我们再次调用 setArguments() 将会导致 java.lang.IllegalStateException: Fragment already active 异常。<br><strong>解决</strong>：<br>1、可以在add()方法时候,先判断currentFragment.isAdded();<br>2、可以使用setter和getter Fragment的属性方法进行数据的存储和获取;  </p>
<h1 id="19-记录bug-调用fragment的replace加载显示异常的问题"><a href="#19-记录bug-调用fragment的replace加载显示异常的问题" class="headerlink" title="19. 记录bug:调用fragment的replace加载显示异常的问题"></a>19. 记录bug:调用fragment的replace加载显示异常的问题</h1><p><strong>现象</strong>：<br>现有FragmentA和FragmentB，当前显示FragmentA，用fragmentTransaction调用replace加载FragmentB时，可能会出现加载不成功的情况，显示的还是FragmentA<br><strong>分析</strong>：<br>使用replace会带来一个问题，FragmentA在replace后会被销毁，会调用其生命周期函数(onDestoryView()、onPause()、onDestory())。如果频繁地replace Fragment会不断创建新实例并销毁旧的，无法重用。经过多次切换后，会导致Fragment上的View无法加载的问题，此时就会出现点击切换图标，还是显示FragmentA<br><strong>解决</strong>：<br>可以利用add()方法配合show()和hide()来弥补replace带来的低效问题  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">hideFragments</span><span class="params">(FragmentTransaction transaction)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (indexFragment != <span class="literal">null</span>) &#123;</span><br><span class="line">            transaction.hide(indexFragment);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (newVenueFragment != <span class="literal">null</span>) &#123;</span><br><span class="line">            transaction.hide(newVenueFragment);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sportVenueFragment != <span class="literal">null</span>) &#123;</span><br><span class="line">            transaction.hide(sportVenueFragment);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (messageMainFragment != <span class="literal">null</span>) &#123;</span><br><span class="line">            transaction.hide(messageMainFragment);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mineFragment != <span class="literal">null</span>) &#123;</span><br><span class="line">            transaction.hide(mineFragment);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//再调用如下方法来显示你要替换的fragment</span></span><br><span class="line">fragmentTransaction.show(indexFragment);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="20-ScrollView中嵌套ListView时，ListView抢夺焦点问题"><a href="#20-ScrollView中嵌套ListView时，ListView抢夺焦点问题" class="headerlink" title="20. ScrollView中嵌套ListView时，ListView抢夺焦点问题"></a>20. ScrollView中嵌套ListView时，ListView抢夺焦点问题</h1><p>ListView嵌入到可滚动的控件中时，ListView会抢夺页面的焦点。对于此类问题的终极解决方案是：使用属性 <strong>descendantFocusabilit</strong>。<br>android:descendantFocusability属性共有三个取值<br>1 beforeDescendants：viewgroup 会优先其子类控件而获取到焦点<br>2 afterDescendants： viewgroup 只有当其子类控件不需要获取焦点时才获取焦点<br>3 blocksDescendants：viewgroup 会覆盖子类控件而直接获得焦点   </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.quncao.pulltorefreshlib.PullToRefreshScrollView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/pullToRefreshScrollView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;#e8e8e8&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:descendantFocusability</span>=<span class="string">&quot;blocksDescendants&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="21-ScrollView-MATCH-PARENT-无法填满屏幕"><a href="#21-ScrollView-MATCH-PARENT-无法填满屏幕" class="headerlink" title="21. ScrollView MATCH_PARENT 无法填满屏幕"></a>21. ScrollView MATCH_PARENT 无法填满屏幕</h1><p>在ScrollView中嵌套一个RelativeLayout,并设置MATCH_PARENT给RelativeLayout。此时想在屏幕底部放置一个Button会出现无法正确的固定到底部。<br>通过设置ScrollView的android:fillViewport为true可以解决此问题。</p>
<p>当ScrollView未设置fillViewport=“true”时, 里面的元素(比如LinearLayout)会按照wrap_content来计算(不论它是否设了”match_parent”),而如果LinearLayout的元素设置了match_parent,那么也是不管用的。因为LinearLayout依赖里面的元素，而里面的元素又依赖LinearLayout,这样自相矛盾。所以里面元素设置了match_parent，也会当做wrap_content来计算。</p>
<h1 id="22-判断RecyclerView是否可以垂直滚动"><a href="#22-判断RecyclerView是否可以垂直滚动" class="headerlink" title="22. 判断RecyclerView是否可以垂直滚动"></a>22. 判断RecyclerView是否可以垂直滚动</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">RecyclerView.canScrollVertically(<span class="number">1</span>)的值表示是否能向上滚动，<span class="literal">false</span>表示已经滚动到底部</span><br><span class="line">RecyclerView.canScrollVertically(-<span class="number">1</span>)的值表示是否能向下滚动，<span class="literal">false</span>表示已经滚动到顶部</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下面这段代码是在PtrFrameLayout中嵌套RecyclerView的例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ptrFrame.setPtrHandler(<span class="keyword">new</span> <span class="title class_">PtrHandler</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onRefreshBegin</span><span class="params">(PtrFrameLayout frame)</span> &#123;</span><br><span class="line">        onRefreshBefore();</span><br><span class="line"></span><br><span class="line">        fetchDataFromServer();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkCanDoRefresh</span><span class="params">(PtrFrameLayout frame, View content, View header)</span> &#123;</span><br><span class="line">        <span class="comment">// 默认实现，根据实际情况做改动</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> !mRecyclerView.canScrollVertically(-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="23-LoaderManager的使用"><a href="#23-LoaderManager的使用" class="headerlink" title="23. LoaderManager的使用"></a>23. LoaderManager的使用</h1><p>1.Loader特性：<br>(1).对于每个Activity或者Fragment都可用<br>(2).提供异步加载数据<br>(3).监视数据资源，当内容改变时重新更新<br>(4).当配置改变时，自动重新连接最新的cursor，故不需要重新查询数据  </p>
<p>2.Loader相关类接口<br>(1).LoaderManager<br>对于每个activity或者fragment只存在一个与之相关的LoaderManager对象,该LoaderManager对象可以存在多个可供管理loader对象。<br>(2).LoaderManager.LoaderCallbacks<br>LoaderManager.LoaderCallbacks是个回掉接口，用于客户端与LoaderManager的交互，loader对象就是在其接口的onCreateLoader()方法中得到，在使用时需要覆盖其方法。<br>(3).CursorLoader<br>CursorLoader是AsyncTaskLoader的子类，通过它可以查询ContentResolver并返回一个Cursor对象，并使用该cursor对象在后台线程执行查询操作，以不至于会阻塞主线程，从一个内容提供者去异步加载数据是CursorLoader对象最大用处。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GalleryFragment</span> <span class="keyword">extends</span> <span class="title class_">Fragment</span> <span class="keyword">implements</span> <span class="title class_">LoaderManager</span>.LoaderCallbacks&lt;Cursor&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> GalleryAdapter mGalleryAdapter;</span><br><span class="line">    <span class="keyword">private</span> ImageLoader imageLoader;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 切换目录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dirId   目录id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dirName 目录名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">switchDir</span><span class="params">(<span class="type">int</span> dirId, String dirName)</span> &#123;</span><br><span class="line">        <span class="type">Bundle</span> <span class="variable">bundle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bundle</span>();</span><br><span class="line">        bundle.putInt(<span class="string">&quot;dirId&quot;</span>, dirId);</span><br><span class="line">        getLoaderManager().restartLoader(<span class="number">0</span>, bundle, <span class="built_in">this</span>);</span><br><span class="line">        title.setText(dirName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onStop();</span><br><span class="line">        imageLoader.stop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Loader&lt;Cursor&gt; <span class="title function_">onCreateLoader</span><span class="params">(<span class="type">int</span> id, Bundle args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">select</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (args != <span class="literal">null</span>) &#123;</span><br><span class="line">            dirId = args.getInt(<span class="string">&quot;dirId&quot;</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (dirId != <span class="number">0</span>) &#123;</span><br><span class="line">                select = String.format(<span class="string">&quot;%s == %s&quot;</span>, MediaStore.Images.Media.BUCKET_ID, dirId);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Uri</span> <span class="variable">baseUri</span> <span class="operator">=</span> MediaStore.Images.Media.EXTERNAL_CONTENT_URI;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CursorLoader</span>(getActivity(),</span><br><span class="line">                baseUri,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;MediaStore.Images.Media._ID, MediaStore.Images.Media.DATA,&#125;,</span><br><span class="line">                select,</span><br><span class="line">                <span class="literal">null</span>,</span><br><span class="line">                MediaStore.Images.Media.DATE_TAKEN + <span class="string">&quot; DESC&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLoadFinished</span><span class="params">(Loader&lt;Cursor&gt; loader, Cursor data)</span> &#123;</span><br><span class="line">        mGalleryAdapter.swapCursor(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLoaderReset</span><span class="params">(Loader&lt;Cursor&gt; loader)</span> &#123;</span><br><span class="line">        mGalleryAdapter.swapCursor(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="24-不透明度16进制值"><a href="#24-不透明度16进制值" class="headerlink" title="24. 不透明度16进制值"></a>24. 不透明度16进制值</h1><table>
<thead>
<tr>
<th align="center">不透明度</th>
<th align="center">16进制值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">100%</td>
<td align="center">FF</td>
</tr>
<tr>
<td align="center">95%</td>
<td align="center">F2</td>
</tr>
<tr>
<td align="center">90%</td>
<td align="center">E6</td>
</tr>
<tr>
<td align="center">85%</td>
<td align="center">D9</td>
</tr>
<tr>
<td align="center">80%</td>
<td align="center">CC</td>
</tr>
<tr>
<td align="center">75%</td>
<td align="center">BF</td>
</tr>
<tr>
<td align="center">70%</td>
<td align="center">B3</td>
</tr>
<tr>
<td align="center">65%</td>
<td align="center">A6</td>
</tr>
<tr>
<td align="center">60%</td>
<td align="center">99</td>
</tr>
<tr>
<td align="center">55%</td>
<td align="center">8C</td>
</tr>
<tr>
<td align="center">50%</td>
<td align="center">80</td>
</tr>
<tr>
<td align="center">45%</td>
<td align="center">73</td>
</tr>
<tr>
<td align="center">40%</td>
<td align="center">66</td>
</tr>
<tr>
<td align="center">35%</td>
<td align="center">59</td>
</tr>
<tr>
<td align="center">30%</td>
<td align="center">4D</td>
</tr>
<tr>
<td align="center">25%</td>
<td align="center">40</td>
</tr>
<tr>
<td align="center">20%</td>
<td align="center">33</td>
</tr>
<tr>
<td align="center">15%</td>
<td align="center">26</td>
</tr>
<tr>
<td align="center">10%</td>
<td align="center">1A</td>
</tr>
<tr>
<td align="center">5%</td>
<td align="center">0D</td>
</tr>
<tr>
<td align="center">0%</td>
<td align="center">00</td>
</tr>
</tbody></table>
<h1 id="25-髙扇入低扇出"><a href="#25-髙扇入低扇出" class="headerlink" title="25. 髙扇入低扇出"></a>25. 髙扇入低扇出</h1><p>在软件设计中，扇入和扇出的概念是指应用程序模块之间的层次调用情况。按照结构化设计方法，一个应用程序是由多个功能相对独立的模块所组成。扇入：是指直接调用该模块的上级模块的个数。扇入大表示模块的复用程序高。</p>
<p>扇出：是指该模块直接调用的下级模块的个数。扇出大表示模块的复杂度高，需要控制和协调过多的下级模块；但扇出过小（例如总是1）也不好。扇出过大一般是因为缺乏中间层次，应该适当增加中间层次的模块。扇出太小时可以把下级模块进一步分解成若干个子功能模块，或者合并到它的上级模块中去。</p>
<p>设计良好的软件结构，通常顶层扇出比较大，中间扇出小，底层模块则有大扇入。</p>
<h1 id="26-What-How-Why"><a href="#26-What-How-Why" class="headerlink" title="26. What-How-Why"></a>26. What-How-Why</h1><ul>
<li>What - “What is it?” 你要搞清楚某个东东是【什么】样子的？有【什么】用处？有【什么】特性？有【什么】语法？</li>
<li>How - “How to do?” 你要搞清楚某个东西，其内部是【如何】运作的？【如何】实现的？</li>
<li>Why - 就是搞清楚某个东西【为什么】设计成这样？【为什么】不是另外的样子？这样的设计有什么讲究？</li>
</ul>
<h1 id="27-网络框架应具备的功能"><a href="#27-网络框架应具备的功能" class="headerlink" title="27. 网络框架应具备的功能"></a>27. 网络框架应具备的功能</h1><h2 id="27-1-OkHttp"><a href="#27-1-OkHttp" class="headerlink" title="27.1. OkHttp"></a>27.1. OkHttp</h2><p><a target="_blank" rel="noopener" href="http://blog.csdn.net/sunshine2050_csdn/article/details/50819261">OkHttp3升级实践与之前2.0对比</a></p>
<ul>
<li>提供一个合适的辅助类</li>
<li>基本的get，post请求</li>
<li>基本的同步和异步请求</li>
<li>下载文件以及进度回调<ul>
<li>对于超过1MB的响应body，应使用流的方式来处理body。</li>
</ul>
</li>
<li>取消某个网络请求</li>
<li>OkHttp参数配置</li>
<li>配置日志打印拦截器</li>
<li>配置网络连接拦截器</li>
<li>参考 <a target="_blank" rel="noopener" href="https://github.com/hongyangAndroid/okhttp-utils">https://github.com/hongyangAndroid/okhttp-utils</a></li>
<li>单例方式提供OkHttpClient</li>
</ul>
<h2 id="27-2-Retrofit"><a href="#27-2-Retrofit" class="headerlink" title="27.2. Retrofit"></a>27.2. Retrofit</h2><ul>
<li>使用原生的Call类型处理返回结果</li>
<li>使用RxJava方式处理返回结果</li>
<li>解决Https访问的问题，SSLSocketFactory</li>
<li>解决直接返回String类型数据的问题，StringConverterFactory <a target="_blank" rel="noopener" href="http://www.jianshu.com/p/308f3c54abdd">http://www.jianshu.com/p/308f3c54abdd</a></li>
<li>配置统一的OkHttpClient给Retrofit</li>
<li>处理先后访问两个网络请求的情况[需求：获取某人的某个项目下所有关注者自己的所有项目列表]</li>
<li>下载jar包</li>
<li>配置网络连接拦截器</li>
<li>对返回结果再封装</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/iBlogWebsite/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/iBlogWebsite/">1</a><span class="space">&hellip;</span><a class="page-number" href="/iBlogWebsite/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/iBlogWebsite/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/iBlogWebsite/page/11/">11</a><a class="extend next" rel="next" href="/iBlogWebsite/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Leeeyou"
      src="https://avatars1.githubusercontent.com/u/6735624?s=460&v=4">
  <p class="site-author-name" itemprop="name">Leeeyou</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/iBlogWebsite/archives/">
        
          <span class="site-state-item-count">110</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/iBlogWebsite/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/iBlogWebsite/tags/">
          
        <span class="site-state-item-count">74</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Leeeyou" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Leeeyou" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leeeyou</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/iBlogWebsite/lib/anime.min.js"></script>
  <script src="/iBlogWebsite/lib/velocity/velocity.min.js"></script>
  <script src="/iBlogWebsite/lib/velocity/velocity.ui.min.js"></script>

<script src="/iBlogWebsite/js/utils.js"></script>

<script src="/iBlogWebsite/js/motion.js"></script>


<script src="/iBlogWebsite/js/schemes/muse.js"></script>


<script src="/iBlogWebsite/js/next-boot.js"></script>




  




  
<script src="/iBlogWebsite/js/local-search.js"></script>













  

  

</body>
</html>
